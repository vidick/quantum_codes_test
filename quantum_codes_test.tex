\documentclass[11pt]{article}
\usepackage{booktabs}
\usepackage{fullpage}
\usepackage{titlesec}
%\newcommand{\sectionbreak}{\clearpage}
\usepackage{amsmath,amsfonts,amsthm,mathrsfs,xspace,graphicx}
\usepackage[backref,colorlinks,citecolor=blue,bookmarks=true]{hyperref}
\usepackage{mathpazo}
\usepackage{endnotes}
\usepackage{color}
\usepackage{float}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{bbm}
\usepackage{suffix} % for *-version commands
\usepackage{times}
\usepackage{tabularx}
\usepackage{makecell}
\usepackage{amssymb,latexsym}
%\usepackage{IEEEtrantools}
\usepackage[capitalize]{cleveref}
\usepackage{enumitem}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage[affil-it]{authblk}


\mdfdefinestyle{figstyle}{ %
  linecolor=black!7, %
  backgroundcolor=black!7, %
  innertopmargin=10pt, %
  innerleftmargin=25pt, %
  innerrightmargin=25pt, %
  innerbottommargin=10pt %
}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{corollary}[theorem]{Corollary}

\newtheorem{remark}[theorem]{Remark}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\newcommand{\beq}{\begin{eqnarray}}
\newcommand{\eeq}{\end{eqnarray}}

\newcommand{\code}{\mathcal{C}}
\newcommand{\strategy}{\mathscr{S}}
\newcommand{\algebra}{\mathscr{A}}

\newcommand{\ket}[1]{|#1\rangle}
\newcommand{\bra}[1]{\langle#1|}
\newcommand{\ketbra}[2]{\ket{#1}\!\bra{#2}}
\newcommand{\ip}[2]{\langle #1 \! | #2 \rangle}
\newcommand{\proj}[1]{\ket{#1}\!\bra{#1}}
\newcommand{\Tr}{\mbox{\rm Tr}}
\newcommand{\Id}{\ensuremath{I}}
\DeclareMathOperator*{\Expectation}{\mathbb{E}}
\newcommand{\Es}[1]{\Expectation_{#1}}

\newcommand{\reg}[1]{{\textsf{#1}}}
\newcommand{\ol}[1]{\overline{#1}}

\newcommand{\field}{\mathbb{F}_2}
\newcommand{\C}{\ensuremath{\mathbb{C}}}
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\bbN}{\ensuremath{\mathbb{N}}}
\newcommand{\complex}{\ensuremath{\mathbb{C}}}
\newcommand{\real}{\ensuremath{\mathbb{R}}}
%\newcommand{\natural}{\ensuremath{\mathbb{N}}}

\newcommand{\bij}{\pi}
\newcommand{\qp}{\tau}
\newcommand{\dlS}{\ensuremath{\rm dlS}}

\newcommand{\F}{\ensuremath{\mathbb{F}}}
\newcommand{\M}{\ensuremath{\mathbb{M}}}
\newcommand{\ot}{\otimes}
\newcommand{\Fp}{\F_p}
\newcommand{\Fq}{\field}
\newcommand{\BH}{\textsc{BH}}
\newcommand{\ld}{\textsc{ld}}
\newcommand{\downsize}{\kappa}
\newcommand{\tobin}{\flat}
\newcommand{\downsizem}{\chi}

\newcommand{\K}{\ensuremath{\mathbb{K}}}
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}

\newcommand{\mA}{\ensuremath{\mathcal{A}}}
\newcommand{\mB}{\ensuremath{\mathcal{B}}}
\newcommand{\mC}{\ensuremath{\mathcal{C}}}
\newcommand{\mE}{\ensuremath{\mathcal{E}}}
\newcommand{\mD}{\ensuremath{\mathcal{D}}}
\newcommand{\mF}{\ensuremath{\mathcal{F}}}
\newcommand{\mG}{\ensuremath{\mathcal{G}}}
\newcommand{\mH}{\ensuremath{\mathcal{H}}}
\newcommand{\mK}{\ensuremath{\mathcal{K}}}
\newcommand{\mM}{\ensuremath{\mathcal{M}}}
\newcommand{\mI}{\ensuremath{\mathcal{I}}}
\newcommand{\mJ}{\ensuremath{\mathcal{J}}}
\newcommand{\cM}{\ensuremath{\mathcal{M}}}
\newcommand{\mP}{\ensuremath{\mathcal{P}}}
\newcommand{\mQ}{\ensuremath{\mathcal{Q}}}
\newcommand{\mR}{\ensuremath{\mathcal{R}}}
\newcommand{\mS}{\ensuremath{\mathcal{S}}}
\newcommand{\mT}{\ensuremath{\mathcal{T}}}
\newcommand{\mX}{\ensuremath{\mathcal{X}}}
\newcommand{\mY}{\ensuremath{\mathcal{Y}}}

\newcommand{\Inv}{\ensuremath{\textsc{Inv}}}
\newcommand{\GEN}{\ensuremath{\textsc{GEN}}}
\newcommand{\SAMP}{\ensuremath{\textsc{SAMP}}}
\newcommand{\epr}{\ensuremath{\textsc{epr}}}
\newcommand{\RM}{\ensuremath{\textsc{RM}}}
\newcommand{\Had}{\ensuremath{\textsc{Had}}}
\newcommand{\HRM}{\ensuremath{\textsc{HRM}}}


\newcommand{\Alg}{\mathcal{A}}
\newcommand{\ind}{\ensuremath{\mathrm{ind}}}


\newcommand{\setft}[1]{\mathrm{#1}}
\newcommand{\Density}{\setft{D}}
\newcommand{\Pos}{\setft{Pos}}
\newcommand{\Proj}{\setft{Proj}}
\newcommand{\Channel}{\setft{C}}
\newcommand{\Unitary}{\setft{U}}
\newcommand{\Herm}{\setft{Herm}}
\newcommand{\Lin}{\setft{L}}
\newcommand{\Trans}{\setft{T}}
\DeclareMathOperator{\poly}{poly}
\DeclareMathOperator{\negl}{negl}
\newcommand{\dset}{G}

\newcommand{\val}{\ensuremath{\mathrm{val}}}
\newcommand{\valco}{\ensuremath{\mathrm{val}^{\mathrm{co}}}}
\newcommand{\ia}{\Id_\alice}
\newcommand{\ib}{\Id_\bob}

\newcommand{\desc}[1]{\overline{\cal{#1}}}
\newcommand{\supp}{\textsc{Supp}}
\newcommand{\Gen}{\textsc{Gen}}
\newcommand{\Enc}{\textsc{Enc}}
\newcommand{\Dec}{\textsc{Dec}}

\newcommand{\GenTrap}{\textsc{GenTrap}}
\newcommand{\Invert}{\textsc{Invert}}
\newcommand{\lossy}{\textsc{lossy}}

\newcommand{\rand}{\textrm{rand}}
\newcommand{\had}{\textsc{Had}}


\newcommand{\eps}{\varepsilon}
\newcommand{\ph}{\ensuremath{\varphi}}


\newcommand{\ac}{\textsc{ac}}
\newcommand{\GX}{\textsc{Gap-Maxcut}}
\newcommand{\GNI}{\textsc{Graph Non-Isomorphism}}


\newcommand{\Acc}{\textsc{Acc}}
\newcommand{\Samp}{\textsc{Samp}}
\newcommand{\Ext}{\ensuremath{\text{Ext}}}

\newcommand{\BD}{\mathbb{QB}}
\newcommand{\DD}{\mathbb{D}}
\newcommand{\DDb}{\mathbb{D'}}
\newcommand{\Pot}{\Phi}
\newcommand{\inj}{J}
\newcommand{\mZ}{\mathcal{Z}}
\newcommand{\mN}{\mathcal{N}}
\newcommand{\vs}{\vspace{2mm}~\newline\noindent}
\newcommand{\vb}{\vspace{3mm}\noindent}
\newcommand{\sX}{\mathcal{X}}
\newcommand{\sA}{\mathcal{A}}
\newcommand{\sB}{\mathcal{B}}
\newcommand{\sY}{\mathcal{Y}}
\newcommand{\sR}{\mathcal{R}}


\newcommand{\trnq}[1]{\left[ {#1} \right]_q}

\DeclareMathOperator{\polylog}{polylog}
\newcommand{\mx}[1]{\mathbf{{#1}}}
\newcommand{\vc}[1]{\mathbf{{#1}}}
\newcommand{\abs}[1]{\left\vert {#1} \right\vert}
\newcommand{\norm}[1]{\left\| {#1} \right\|}
\newcommand{\for}{\text{for }}

\DeclareMathOperator{\arcsinh}{arcsinh}
\DeclareMathOperator{\tr}{tr}

\newcommand{\E}{\mathop{\mathbb{E}}\displaylimits} % Expectation

\newcommand{\unif}{\mathcal{U}}
\newcommand{\pt}{\textrm{pt}}
\newcommand{\sample}{\textrm{sample}}
\newcommand{\test}{\textrm{test}}
\newcommand{\free}{\mathcal{F}}
\newcommand{\plane}{\mathcal{P}}
\newcommand{\lines}{\mathcal{L}}
\newcommand{\clines}{\mathcal{CL}}
\newcommand{\pl}{\mathbf{p}}
\newcommand{\individual}{\textrm{individual}}
\newcommand{\blocks}{\textrm{blocks}}
\newcommand{\liness}{\textrm{lines}}
\newcommand{\lp}{\mathcal{LP}}
\newcommand{\Pl}{\ensuremath{\mathrm{Pl}}}
\newcommand{\Ln}{\ensuremath{\mathrm{Lines}}}
\newcommand{\mode}{\mathfrak{m}}
\newcommand{\ECC}{\ensuremath{\textsc{ECC}}}
\newcommand{\EC}{\ensuremath{\textsc{EC}}}
\newcommand{\ENC}{\ensuremath{\textsc{ENC}}}
\newcommand{\cktval}{\ensuremath{\textsc{CKTVAL}}}


\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Matrix}{\mathrm{M}}
\newcommand{\End}{\mathrm{End}}
\newcommand{\Aut}{\mathrm{Aut}}

\newcommand{\game}{\mathfrak{G}}
\newcommand{\sampler}{\mathcal{S}}
\newcommand{\decider}{\mathcal{D}}
\newcommand{\verifier}{\mathcal{V}}


\newcommand{\type}{\mathcal{T}}
\newcommand{\lt}{\mathcal{L}}
\newcommand{\rt}{\mathcal{R}}
\newcommand{\checker}{\mathcal{C}}


\newcommand{\gamestyle}[1]{\ensuremath{\textsc{#1}}\xspace}
\newcommand{\qld}{\gamestyle{QLD}}
\newcommand{\ms}{\gamestyle{MS}}
\newcommand{\pauli}{\gamestyle{Pauli}}
%\newcommand{\bp}{\gamestyle{BP}}
\newcommand{\ora}{\gamestyle{Orac}}
\newcommand{\pcp}{\gamestyle{PCP}}
\newcommand{\ar}{\gamestyle{AR}}
\newcommand{\intro}{\gamestyle{Intro}}

\newcommand{\labelstyle}[1]{\ensuremath{\textsc{#1}}\xspace}
\newcommand{\EPR}{\labelstyle{EPR}}
\newcommand{\aux}{\labelstyle{aux}}
\newcommand{\ancilla}{\labelstyle{anc}}
\newcommand{\msc}{\labelstyle{MC}}
\newcommand{\msv}{\labelstyle{MV}}
\newcommand{\vertex}[1]{\labelstyle{V#1}}
\newcommand{\edge}[1]{\labelstyle{N#1}}
\newcommand{\basis}{\labelstyle{W}}
\newcommand{\xpt}{\labelstyle{X}}
\newcommand{\zpt}{\labelstyle{Z}}
\newcommand{\rxpt}{\labelstyle{R}_\xpt}
\newcommand{\rzpt}{\labelstyle{R}_\zpt}
\newcommand{\dir}[1]{\labelstyle{V#1}}
\newcommand{\coord}{\labelstyle{I}}
\newcommand{\intercept}{\labelstyle{U}}
\newcommand{\plf}{\labelstyle{Pl}}
\newcommand{\lnf}{\labelstyle{Ln}}
\newcommand{\ptf}{\labelstyle{Pt}}
\newcommand{\full}{\labelstyle{full}}
\newcommand{\opt}{\labelstyle{opt}}
\newcommand{\partition}{\mathcal{B}}

\newcommand{\tvarstyle}[1]{\mathsf{#1}}
\newcommand{\tvar}{\ensuremath{\tvarstyle{t}}}
\newcommand{\lvar}{\ensuremath{\tvarstyle{u}}}
\newcommand{\rvar}{\ensuremath{\tvarstyle{v}}}
\newcommand{\pvar}{\ensuremath{\tvarstyle{p}}}
\newcommand{\ovar}{\ensuremath{\tvarstyle{o}}}
\newcommand{\trole}{\ensuremath{v}} % used in intro types

\newcommand{\types}{\labelstyle{T}}

\newcommand{\decode}{\labelstyle{Decode}}

%\newcommand{\alice}{\labelstyle{Alice}}
%\newcommand{\bob}{\labelstyle{Bob}}
\newcommand{\alice}{\labelstyle{A}}
\newcommand{\bob}{\labelstyle{B}}

\newcommand{\oracle}{\labelstyle{Oracle}}
\newcommand{\ab}{\{\alice, \bob\}}

\newcommand{\typestyle}[1]{\ensuremath{\textsc{#1}}\xspace}
\newcommand{\Type}{\typestyle{Type}}
\newcommand{\Plane}{\typestyle{Plane}}
\renewcommand{\line}{\mathbf{\ell}}
\newcommand{\Llane}{\typestyle{Line}}
\newcommand{\Point}{\typestyle{Point}}
\newcommand{\HPoint}{\typestyle{HPoint}}
\newcommand{\Line}{\typestyle{Line}}
\newcommand{\ALine}{\typestyle{ALine}}
\newcommand{\DLine}{\typestyle{DLine}}
\newcommand{\Pair}{\typestyle{Pair}}
\newcommand{\Constraint}{\typestyle{Constraint}}
\newcommand{\Variable}{\typestyle{Variable}}
\newcommand{\Pauli}{\typestyle{Pauli}}
\newcommand{\Sample}{\typestyle{Sample}}
\newcommand{\Read}{\typestyle{Read}}
\newcommand{\MeasureX}{\typestyle{MeasureX}}
\newcommand{\Hide}[1]{\typestyle{Hide}_{#1}}
\newcommand{\HideX}[1]{\typestyle{HideX}_{#1}}
\newcommand{\Target}[1]{\typestyle{Target}_{#1}}
\newcommand{\Oracle}{\typestyle{Oracle}}
\newcommand{\Introspect}{\typestyle{Intro}}
\newcommand{\Intro}{\typestyle{Intro}}
\newcommand{\Simple}{\typestyle{Simple}}
\newcommand{\Eval}{\typestyle{Eval}}
\newcommand{\Agg}{\typestyle{Agg}}
\newcommand{\Input}{\typestyle{Input}}
\newcommand{\Skip}{\typestyle{Skip}}
\newcommand{\Alice}{\typestyle{Alice}}
\newcommand{\Bob}{\typestyle{Bob}}
\newcommand{\Edge}{\typestyle{Alice}}
\newcommand{\Vertex}{\typestyle{Bob}}
\newcommand{\Anchor}{\typestyle{Anchor}}
\renewcommand{\Game}{\typestyle{Game}}
\newcommand{\AB}{\{\alice, \bob\}}
\newcommand{\ctrl}{\labelstyle{c}}
\newcommand{\target}{\labelstyle{t}}

\newcommand{\abc}[1][\delta]{\otimes I_\bob \simeq_{#1} I_\alice \otimes}

\newcommand{\ldc}{k} % number of copies of classical ld tests

\newcommand{\class}[1]{\ensuremath{\mathsf{#1}}\xspace}
\newcommand{\NP}{\class{NP}} %
\newcommand{\IP}{\class{IP}} %
\newcommand{\EXP}{\class{EXP}} %
\newcommand{\NEXP}{\class{NEXP}} %
\newcommand{\QMA}{\class{QMA}} %
\newcommand{\QMIP}{\class{QMIP}} %
\WithSuffix\newcommand\QMIP*{\ensuremath{\class{QMIP}^*}} %
\newcommand{\PSPACE}{\class{PSPACE}} %
\newcommand{\PCP}{\class{PCP}} %
\newcommand{\MIP}{\class{MIP}} %
\newcommand{\MIPco}{\class{MIP}^{\mathrm{co}}} %
\newcommand{\RE}{\class{RE}} %
\newcommand{\coRE}{\class{coRE}}
\newcommand{\NEEXP}{\class{NEEXP}} %
\newcommand{\NEEEXP}{\class{NEEEXP}}
\WithSuffix\newcommand\MIP*{\ensuremath{\class{MIP}^*}} %
\newcommand{\QIP}{\class{QIP}} %


\newcommand{\Ent}{\mathscr{E}}
\newcommand{\compr}{\textsc{Compr}}
\newcommand{\halt}{\textsc{Halt}}
\newcommand{\machine}{\cal{M}}
\renewcommand{\cal}[1]{\mathcal{#1}}
\newcommand{\Kleene}{\cal{K}}
\newcommand{\qldparams}{\mathsf{qldparams}}
\mathchardef\mhyphen="2D
\newcommand{\Fqldparams}{\F_2\mhyphen\mathsf{qldparams}}
\newcommand{\introparams}{\mathsf{introparams}}
\newcommand{\ldparams}{\mathsf{ldparams}}
\newcommand{\tmldparams}{\mathsf{tmldparams}}
\newcommand{\pcpparams}{\mathsf{pcpparams}}

\newcommand{\TMtoSAT}{\mathrm{TMtoSAT}}
\newcommand{\TMtoLD}{\mathrm{TMtoLD}}
\newcommand{\BoundedHalting}{\mathrm{BH}}
\newcommand{\timecomplexity}{\mathsf{TIME}}
\newcommand{\TIME}{\mathsf{TIME}}
\newcommand{\answer}{\mathsf{ANS}}
\newcommand{\MS}{\mathrm{MS}}

\newcommand{\accept}{\typestyle{Accept}}
\newcommand{\reject}{\typestyle{Reject}}

\newcommand{\anch}{\gamestyle{Anch}}
\newcommand{\ans}{\gamestyle{ANS}}
%%%%%%%self testing macros%%%%%%%%%%

\newcommand{\local}{\mathrm{local}}
%\newcommand{\aux}{\mathrm{aux}}


\newcommand{\G}{\mG}
\newcommand{\XZ}{\mathcal{B}}
\newcommand{\hilb}{\mathcal{H}}


%\newcommand{\tmstyle}[1]{\ensuremath{\textsf{#1}}}
\newcommand{\tmstyle}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\Compress}{\tmstyle{Compress}}
\newcommand{\ComputeRepetitions}{\tmstyle{ComputeRepetitions}}
\newcommand{\ComputeSampler}{\tmstyle{ComputeSampler}}
\newcommand{\RawIntroSampler}{\tmstyle{RawIntroSampler}}
\newcommand{\ComputeIntroSampler}{\tmstyle{IntroSampler}}
\newcommand{\RawIntroDecider}{\tmstyle{RawIntroDecider}}
\newcommand{\ComputeIntroDecider}{\tmstyle{IntroDecider}}
\newcommand{\ComputeIntroVerifier}{\tmstyle{IntroVerifier}}
\newcommand{\ComputeOracleVerifier}{\tmstyle{OracleVerifier}}
\newcommand{\ComputeAnsVerifier}{\tmstyle{AnsRedVerifier}}
\newcommand{\ComputeParrepVerifier}{\tmstyle{RepeatedVerifier}}
\newcommand{\ComputePCPVerifier}{\tmstyle{PCPVerifier}}
\newcommand{\ComputeFixedPoint}{\tmstyle{ComputeFixedPoint}}
\newcommand{\detype}{\tmstyle{Detype}}

\newenvironment{gamespec}{
  \begin{mdframed}[style=figstyle]}{
  \end{mdframed}}

\newcommand{\zero}{\mathrm{zero}}

%%%%%%%From NW19:%%%%%%%%%%
\newcommand{\polymeas}[3]{\mathrm{PolyMeas}(#1,#2,#3)}
\newcommand{\simulpolymeas}[4]{\mathrm{PolyMeas}(#1,#2,#3, #4)}

\newcommand{\eval}{\mathrm{eval}}

%\newcommand{\coin}{o}
\newcommand{\succinctdecider}{\ensuremath{\mathsf{SuccinctDecider}}}
\newcommand{\circuit}{\mathcal{C}}
\newcommand{\formula}{\mathcal{F}}
\newcommand{\bin}{\mathrm{binary}}
\newcommand{\pcpeval}{\Xi}
\newcommand{\pcpverifier}{\mathcal{M}_\ar}
\newcommand{\qlen}{Q}
\DeclareMathOperator{\ev}{eval}

\newcommand{\coded}{\mathrm{Dec}}
\newcommand{\hx}{\hat{x}}
\newcommand{\hz}{\hat{z}}
\newcommand{\htvar}{\hat{\tvar}}
\newcommand{\soundness}{\mathrm{sound}}

\newcommand{\rep}{\gamestyle{Rep}}
\newcommand{\sep}{\gamestyle{Sep}}

\newcommand{\binary}[1]{\mathrm{binary}_{#1}}
\newcommand{\num}[1]{\mathrm{number}_{#1}}
\newcommand{\canbasis}[1]{\mathrm{basis}(#1)}
\newcommand{\canH}[3]{H_{\mathrm{canon}, #1, #2, #3}}
\newcommand{\canlilh}[3]{h_{\mathrm{canon}, #1, #2, #3}}
\newcommand{\canin}[3]{\pi_{\mathrm{canon},#1,#2,#3}}
\newcommand{\canenc}[4]{g_{\mathrm{canon},#1,#2,#3,#4}}


% \usepackage{showlabels}
% \renewcommand{\showlabelfont}{\tiny\ttfamily\color{red}}

\bibliographystyle{alpha}

\newif\ifnotes\notestrue
%\newif\ifnotes\notesfalse

\input{marginnotes}
\begin{document}

\title{Qubit tests from classical codes}

\author{Thomas Vidick and Henry Yuen}
\date{\today}
\maketitle

\noteswarning


\begin{abstract}

\end{abstract}

	\section{Preliminaries}

\subsection{Notation}

When we write $\Es{i\in \mX}$ where $\mX$ is a finite set, we mean the expectation over $i$ chosen uniformly at random from $\mX$, i.e.\ $\frac{1}{|\mX|} \sum_{i\in \mX}$. 

\subsection{Algebra}

  A \emph{tracial von Neumann algebra} is a pair $(\mM,\tau)$ of a von Neumann algebra $\mM$ together with a normal faithful tracial state $\tau$ on $\mM$, which we often refer to as the \emph{trace}. The main example of interest is $\mM=M_n(\C)$, the algebra $n\times n$ complex matrices, with $\tau$ the dimension-normalized trace, which we denote $\tr(M)=\frac{1}{n}\Tr(M)$. 	We write $\|x\|_2=\tau(x^*x)^{1/2}$ for the $2$-norm on $\mM$.
	
	Let $B(\ell_2)$ be the von Neumann algebra of bounded operators on $\ell_2$, the Hilbert space of convergent sequences in $\C^\Z$ equipped with the usual Euclidean norm (for which we let $(e_i)_{i \in \Z}$ denote the standard basis). We denote $\mM_\infty = \mM \overline{\otimes} B(\ell_2)$, where the overline denotes closure for the operator topology. $\mM_\infty$ is a von Neumann algebra equipped with the (infinite) trace $\tau_\infty = \tau \otimes \Tr$, with $\Tr(x)=\sum_{i\in \Z} e_i^T X e_i$ the trace on $B(\ell_2)$. We generally identify $\mM$ with the ``corner'' $\mM\otimes e_{1,1}\subset \mM_\infty$. 

	We let $\F$ denote a finite field, and $\field$ the field with two elements. For $u\in \F^n$ for some $n$, we write $|u|$ for the Hamming weight of $u$, i.e.\ the number of nonzero coordinates. For $a,b \in \F^k$, we write $a \cdot b$ to denote the inner product $\sum_{i=1}^k a_i b_i$. 
	
	
	\subsection{Measurements}
	\label{sec:measurements}
	
	A POVM in\tnote{was ``on'' but actually usually we say ``on'' for the Hilbert space, not the algebra, so I think here it should be ``in''} $\mM$ with outcome set $\mA$ is a finite collection of positive semidefinite operators $\{P_a\}_{a\in \mA}$ such that $\sum_a P_a = \Id_\mM$. A POVM is \emph{projective} if for all $a$, $P_a$ is a projection. 
	Given a projective measurement $\{P_a\}_{a\in \field^k}$ and $b\in \field^k$ we define the corresponding \emph{observable} 
	\[ \widehat{P}(b) = \sum_a (-1)^{a\cdot b} P_a\;,\]
	which is self-adjoint and unitary. If $k=1$, we often use the shorthand $\widehat{P}$ for $\widehat{P}(1) = P_0-P_1$.
	
	We define a specific family of projective measurements on $M_{2^k}(\C)$ which are derived from the \emph{Pauli observables}. Define
	\[ \sigma^X = \begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}\;,\qquad \sigma^Z = \begin{pmatrix} 1 & 0 \\ 0 & -1\end{pmatrix}\;,\]
	and more generally for $a,b\in \F_2^k$ let $\sigma^X(a) = \bigotimes_{i=1}^t (\sigma^X)^{a_i}$ and $\sigma^Z(b) = \bigotimes_{i=1}^t (\sigma^Z)^{b_i}$, which are observables in $M_{2^k}(\C)$. These are self-adjoint unitary operators called Pauli observables. Each observable $\sigma^X(a)$ (resp. $\sigma^Z(b)$) corresponds to the \emph{Pauli measurement} $\{ \sigma^X_a \}_{a \in \F_2^k}$ (resp. $\{ \sigma^Z_b \}_{b \in \F_2^k}$) where (in a slight abuse of notation)  
	%	We slightly abuse notation and write 
	\[ \sigma^X_a = \Es{\alpha\in\F_2^k} (-1)^{a\cdot \alpha} \sigma^X(\alpha)\qquad\text{and}\qquad\sigma^Z_b = \Es{\beta\in\F_2^k} (-1)^{b\cdot\beta} \sigma^Z(\beta).\]
	It is easy to verify that $\{\sigma^X_a\}_a$ and $\{\sigma^Z_b\}_b$ are projections summing to identity.	
	

	

We end with a couple lemma that will prove useful. 
\hnote{there are two algebras $\mM$ and $\mN$ but the trace and identities don't specify which. we should probably write a sentence saying that it's implicit but determined by context...(if we do this, then the superscripts in the previous lemma are not needed)}

	
\subsection{Nonlocal games}

We give standard definitions on nonlocal games. 

\begin{definition}[Game]
A game is a tuple $(\mX,\mu,\mA,D)$ where $\mX$ is a finite set, $\mu$ a distribution on $\mX\times \mX$, $\mA=(\mA(x))_{x\in\mX}$ a collection of finite sets, and 
\[ D: \big\{ (x,y,a,b) : (x,y)\in\text{supp}(\mu),a\in\mA(x),b\in\mA(y)\big\} \;\to\;\{0,1\}\]
such that $D$ is symmetric, i.e. $D(x,y,a,b)=D(y,x,b,a)$ whenever both terms are defined. We often abuse notation and write $\mu$ for the symmetrized marginal of $\mu$, i.e.\ 
\[\mu(x) := \sum_{x'\in \mX} \frac{1}{2}\big(\mu(x,x')+\mu(x',x')\big)\;.\]
\end{definition}

The interpretation of $G=(\mX,\mu,\mA,D)$ as a nonlocal game is the following. In the ``game'', a referee is imagined to sample a pair of ``questions'' $(x,y)\sim \mu$. The question $x$ is sent to a first player, ``Alice,'' and the question $y$ is sent to a second player, ``Bob.'' Each player is tasked with responding with an answer $a\in \mA(x)$ for Alice, and $b\in \mA(y)$ for Bob. The referee accepts the players' answers if and only if $D(x,y,a,b)=1$. 

Nonlocal games provide a framework to study different kinds of bipartite correlations: depending on the level of coordination allowed between Alice and Bob, they may have varying chances of success in the game. 

In quantum mechanics, a local strategy for the players (meaning that each player is required to determine their answer locally, without exchanging information with the other player) is specified by the following. 

\begin{definition}[Synchronous strategy]
If $G=(\mX,\mu,\mA,D)$ is a game and $(\mM,\tau)$ a tracial von Neumann algebra, a \emph{synchronous strategy $\strategy$ for $G$ on $(\mM,\tau)$} is, for every $x\in \mX$, a projective measurement $(P^x_a)_{a\in \mA(x)}$ on $\mM$. The value of a strategy $\strategy$ in $G$ is 
\[ \omega(G;\strategy)\,=\, \sum_{(x,y)\in\mX\times\mX}\frac{1}{2}\big(\mu(x,y)+\mu(y,x)\big) \sum_{(a,b)\in\mA(x)\times\mA(y)} D(x,y,a,b)\, \tau\big(P^x_a \,P^y_b\big) \;.\footnote{Note the symmetrization of $\mu$. This is to avoid explicitly requiring $\mu$ to be permutation-invariant in the definition of a game. \hnote{Didn't quite understand... what would go wrong without this symmetrization?}\tnote{It's so that at some point we can claim that studying synchronous strategies is wlog. Maybe that point happens only outside this note though; so then we can say it's to keep with the formalism of synchronous games} \hnote{sorry, still don't understand... I thought synchronous games just require that $D(x,x,a,b) = 0$ if $a \neq b$. That doesn't have anything to do with whether the distribution is symmetrized, right?}\tnote{You're right, usually they don't have a distribution because it's all about the exact case. It's still convenient though, to define games without explicitly flipping the ``symmetry'' coin. Can we keep it and simply write ``Note the symmetrization of $\mu$, which is for convenience.'' }}\]
We say that $\strategy$ is \emph{perfect} if $\omega(G;\strategy)=1$.
\end{definition}
	
The name \emph{synchronous} stems from the fact that whenever an identical pair $(x,x)$ is chosen, $\tau(P^x_a P^x_b)=0$ for $a\neq b$ due to the requirement that $\{P^x_a\}_a$ is a projective measurement. Thus a synchronous strategy always returns the same answer to the same question. More general strategies, which allow different operators $\{P^x_a\}$ and $\{Q^y_b\}$, do not automatically enforce the synchronicity condition, but we do not consider such strategies here. 
	
\section{Quantum soundness of linear codes}

\tnote{added wrapper text throughout this section}
In this section we introduce a notion of ``quantum soundness'' for a linear error-correcting code. We start with classical definitions around codes, then define quantum soundness and finally we provide an example. 

\subsection{Classical definitions}

\begin{definition}[Linear code]
For $q$ a prime power and $n,k,d$ integer
a $[n,k,d]_q$ linear code is a $k$-dimensional subspace $\code\subseteq \F_q^n$ such that for every $u\in \code$ such that $u\neq 0$, $|u|\geq d$. Equivalently, we think of $\code$ as a linear map $\code:\F_q^k\to \F_q^n$. We write $E_\code \in \F_q^{k\times n}$ \hnote{this notation might be confusing, especially since we use $G$ and $G_{\code,M}$ for games... maybe call it $E_\code$?}\tnote{ok} for the generator matrix defined by $ E_\code^T e_i =\code(e_i)$ \hnote{what is $\code(e_i)$? I think we should just say that the range of $G_\code^T$ is $\code$}\tnote{It's defined a bit above, ``we think of $\code$ as a linear map...''} for all $i\in\{1,\ldots,k\}$, where $\{e_1,\ldots,e_k\}$ is the standard basis of $\F_q^k$. 
\end{definition}

When the subscript $q$ is omitted, it is implicitly taken as $q=2$, i.e.\ the code is assumed to be binary. 

Some codes have the useful property that they can be \emph{locally tested}. Informally, this means that it is possible to distinguish codewords from strings that are far from the code by examining only a randomly chosen constant-size subset of coordinates. We give one possible way to formalize this; for more on the topic see e.g.\ the book chapter by Goldreich~\cite{goldreich_2017}. 


\begin{definition}[Local tester]\label{def:code-test}
Let $\code$ be an $[n,k,d]_q$ linear code, $\delta:[0,1]\to[0,1]$, and $r\in \N$.
An \emph{$r$-local $\delta$-tester for $\code$} is a pair $M = ((M_S)_{S \subseteq [n]},\nu)$ where $\nu$ is a distribution over subsets $S\subseteq [n]$ of size at most $r$, and for each such subset $M_S:\F_q^S\to\{0,1\}$ is a predicate such that the following hold:
\begin{itemize} 
\item (Completeness:) For any $u\in \code$, $\Pr_{S\sim \nu}( M_S(u_S)=1)=1$.
\item (Soundness:) For any $\eps\geq 0$ and any $u\in \F_q^n$ that is within (Hamming) distance at least  $\eps$ from $\code$, $\Pr_{S\sim\nu}(M_S(u_{|S})=0)\geq \delta(\eps)$.  \hnote{should it be $u_S$ or $u|_S$?}\tnote{What difference do you make between the two? We don't define either, so I'm fine using the one you find most intuitive/correct}
\end{itemize}
\end{definition}

%\begin{definition}[Local quantum presentation]
%Let $\code$ be an $[n,k,d]_q$ linear code and $r\in \N$. An \emph{$r$-local quantum presentation of $\code$} is specified by
%\begin{itemize}
%\item A tracial von Neumann algebra $(\mM,\tau)$;
%\item For each $i\in\{1,\ldots,n\}$, a $q$-outcome projective measurement $\{A^i_a\}_{a\in \field} \subseteq \mM$;
%\item For each $S\subseteq \{1,\ldots,n\}$ such that $|S|\leq r$, a projective measurement $\{P^S_a\}_{a\in \field^S}\subseteq \mM$.
%\end{itemize}
%\end{definition}

\subsection{Quantum soundness}
\label{sec:q-soundness}

We now introduce our notion of quantum soundness. Informally, a code is quantum sound, with respect to a specific tester for it, if whenever a family of measurements locally satisfies the constraints imposed by the tester, then it globally it returns a codeword. 

To be more precise, we first introduce the notion of \emph{code presentation}, which is the ``global object'' that we aim to test for. 

\begin{definition}[Code representation]
Let $\code$ be an $[n,k,d]$ linear code. A \emph{presentation} of $\code$ is a pair $(\mM,A)$ of a tracial von Neumann algebra $\mM$ and a collection of projective measurements $A = \{A^i_a\}_{a\in\F_q} \subseteq\mM$ for $i\in\{1,\ldots,n\}$ such that the $\{A^i_a\}$ pairwise commute and $\sum_{c\in\code} \prod_{i=1}^n A^i_{c_i}=\Id$.\footnote{This implies that whenever $u\notin \code$, $\prod_i A^i_{u_i}=0$.} 
\end{definition}

Since the $\{A^i\}$ that form a code presentation mutually commute, as quantum mechanical measurements they can be performed sequentially in any order; this will lead to the same distribution on outcomes $u=(u_1,\ldots,u_n)$. The last condition in the definition implies that for any outcome $u$ that has nonzero probability, $u\in \code$. In finite dimensions, a code presentation is equivalently specified by an orthonormal basis $\{f_1,\ldots,f_D\}$ and an assignment of a codeword $u_j\in \code$ to each $f_j$. 

To define the ``local object'' that the code tester will effectively test for, we first introduce a notion of distance on measurements. At first read it may be helpful to consider the case $\mM=\mN$ and $w=P=1_\mM$, in which case it simplifies significantly. \tnote{moved the defn here; since it's quite important for the paper I prefer that it's not dumped in the preliminaries}


	\begin{definition}[Closeness]\label{def:close}
Let $\{A^i_a\}\subseteq \mM$ and $\{B^i_a\}\subseteq \mN$ be two families of projective measurements on  tracial algebras $(\mM,\tau^\mM)$ and $(\mN,\tau^\mN)$ respectively, indexed by the same set $i\in \mI$ and with the same set of outcomes $a,b\in\mA$. For $\delta\geq0$ and $\mu$ a measure on $\mI$ we say that $\{A^i\}$ and $\{B^i\}$ are $(\delta,\mu)$-close if there exists a projection $P\in\mM_\infty$ of finite trace such that $\mN=P\mM_\infty P$ and $\tau^\mN=\tau_\infty/\tau_\infty(P)$, and a partial isometry $w\in P \mM_\infty \Id_\mM$ such that 
\[ \Es{i\sim\mu} \sum_{a\in\mA} \big\| A^i_a - w^* B^i_a w \big\|_2^2 \,\leq\,\delta\]
and 
\[\max\big\{ \tau^\mM(\Id_\mM-w^*w)\,,\; \tau^\mN(P-ww^*)\big\} \,\leq\, \delta\;.\]
If the measure $\mu$ is omitted then it is understood to be the uniform measure on $\mI$.
\end{definition}

We now define the ``local object.'' This local object depends on a local tester $M$ for the code $\code$. Informally, a \emph{local presentation} of a code $\code$ (with respect to $M$) specifies a family of measurements $\{A^i\}$, just like the global presentation, except that these measurements are not required to commute globally. Instead, it is only required that for every ``local'' set $S\subseteq\{1,\ldots,n\}$ of size $|S|\leq r$ the $\{A^i\}$ for $i\in S$ are close, according to the preceding definition, to a family of commuting measurements $\{B^i\}$ for ${i\in S}$ such that furthermore measuring all $B_i$ lead to an outcome $a\in \field^S$ that would be accepted by the local tester $M$, i.e.\ $M(S,a)=1$. 


\begin{definition}[$\eps$-local presentation]
Let $\code$ be an $[n,k,d]_q$ linear code and $M$ be an $r$-local tester for $\code$. An \emph{$\eps$-local presentation of $(\code,M)$} is a pair $(\mM,A)$ of a tracial von Neumann algebra $\mM$ and a collection of projective measurements $A = \{A^i_a\}_{a\in\F_q} \subseteq\mM$ for $i\in\{1,\ldots,n\}$ such that for any $S\subseteq\{1,\ldots,n\}$ of size $|S|\leq r$ there are $|S|$ pairwise commuting projective measurements $\{B^{S,i}\}_{i \in S }\subset \mM_\infty$, with $B^{S,i} = \{B^{S,i}_b\}_{b\in \F_q}$, such that 
\begin{itemize}
\item $\sum_{a\in \F^S} M(S,a) \, \prod_{i\in S} B^{S,i}_{a_i}= \Id$ 
\item For any $S$ such that $|S|\leq r$ and $i\in S$, let $A^{S,i}=S^i$. Then the two measurement families $\{A^{S,i}\}_{S, i\in S}$ \hnote{Don't quite understand the subscripting, since $A^i$ only depends on $i$}\tnote{I meant to say that we use the same $A_i$ for all $S$ that contain $i$. I rewrote it more explicitly} and $\{B^{S,i}\}_{S, i\in S}$ are $(\eps,\nu')$-close, where $\nu'((S,i))=\nu(S)1_{i\in S}\frac{1}{|S|}$.
\end{itemize} 
\hnote{question about the name: why ``presentation''? the object here is a pair $(\mM,A)$ which looks syntactically the same as a code representation... should it be ``representation''?}\tnote{Yeah...should we use ``presentation'' for both? This avoids confusion with language from representation theory. I did this above, what do you think?}
\end{definition}

Now we define \emph{quantum soundness}, which requires any ``local object'' to be close to a ``global object.''


\begin{definition}[Quantum soundness]\label{def:q-sound}
Let $\code$ be an $[n,k,d]_q$ linear code and $M$ a $r$-local tester for $\code$. Let $\delta:[0,1]\to[0,1]$ be such that $\delta(0)=0$. We say that $(\code,M)$ has \emph{quantum soundness $\delta(\eps)$} if the following holds. For any $\eps$-local presentation $(\mM,A)$ of $(\code,M)$
% such that 
%\[ \Es{S\sim \nu} \Es{i\in S} \sum_{a\in \field^s} \big[ \tau\big(  P^S_a  A^i_{a_i}\big) \big] \,\geq \,1-\eps\;,\] 
there is a presentation $(\mN,B)$ of $\code$ such that the measurement families $A$ and $B$ are $\delta(\eps)$-close. 
\end{definition}

\begin{remark}
Definition~\ref{def:q-sound} can be reformulated in the language of nonlocal games, see Proposition~\ref{prop:sound-game}. 
\end{remark}

\begin{remark}
A necessary condition for a code to be quantum sound is that any $0$-local quantum presentation $(\mM,A)$ is  a presentation of $\mC$. Not all codes satisfy this condition, see e.g.~\cite[Example 2.16]{paddock2022arkhipov}. If $(\mC,M)$ satisfies this condition, then we say that it is \emph{Abelian}. Thus, Abelian codes have, by definition, quantum soundness $\overline{\delta}$ where $\overline{\delta}(0)=0$ and $\overline{\delta}(x)=1$ for $x\in(0,1]$. 
\end{remark}


		
		
\subsection{Example: the Hadamard code}
\label{sec:had}

We give an example of a family of quantum sound codes, the \emph{Hadamard code}. This code can be defined for any  $t\geq 1$ and it is an $[T,t,T/2]_2$ linear code, where $T=2^t$. For simplicity we write  $\code_\had$ to denote this code, omitting $t$. As a linear map, for $i\in\{1,\ldots,t\}$, $\code_\had(e_i) = (x_i)_{x\in \field^t} \in \field^T$, where we identify the index set $\{1,\ldots,T\}$ with the set $\field^t$ in an arbitrary way.  

It is shown in~\cite{blum1990self} that there is a $3$-local $\delta$-tester $M_\had$ for $\code_\had$, where $\delta(\eps)=6\eps$. The distribution $\nu_\had$ is uniform over subsets $\{ x, y, x+y \} \subset \field^t$ where $x,y\in \field^t$ are uniformly and independently chosen. For all $u \in \field^T$, the predicate $M_{\had,S}(u|_S) = 1$ if and only if $u_x + u_y = u_{x+y}$ (where we think of the coordinates of $u$ as being indexed by elements of $\field^t$). 

%$M$ first uses its random tape to select $x,y\in\field^k$uniformly at random and returns the set $S=\{x,y,x+y\}$. For $\pi\in \field^T$, $M(S,\pi_S)$ accepts if and only if $\pi_x + \pi_y  = \pi_{x+y}$. 

In~\cite{natarajan2016robust} show that the Hadamard code is quantum sound. They show this using the language of nonlocal games, but it is straightforward to adapt the argument to the definitions introduced here\tnote{should we do it ``for completeness''?}.\footnote{While~\cite{natarajan2016robust} only show the result for finite-dimensional $\mM$, the same proof works for any tracial von Neumann algebra $(\mM,\tau)$.}
 
\begin{theorem}[Theorem 10 in~\cite{natarajan2016robust}]\label{thm:had-qsound}
There is a universal constant $c>0$ such that for any $t\geq 1$, the pair $(\code_\Had,M_\had)$ has quantum soundness $\delta(\eps)=c\,\eps$.
\end{theorem}


\section{A formulation of quantum soundness in terms of nonlocal games}

In this section we give an equivalent (up to a mild slack in parameters) definition of quantum soundness of a linear code in terms of \emph{robustness} of a nonlocal game associated with the code. This formulation will be important for the statement of our main result. 

\subsection{The code game}

Informally, the game $G_{\code,M}$ associated to a code $\code$ and a local tester $M$ for $\code$ is the ``oracularized'' version of the test executed by $M$. That is, one player in the game is asked to provide an assignment to all variables in the set $S$ queried by the tester, that will satisfy its test, while the other player is asked to provide an assignment to a single $i\in S$ and checked for consistency---this will ensure that the first players' answers are consistent across different sets $S$. The formal definition follows.  

\begin{definition}
Let $\code$ be an $[n,k,d]_q$ linear code and $M$ an $r$-local tester for $\code$. The game $G_{\code,M}$ is defined as follows. We set 
\[\mX = \{ S\subseteq \{1,\ldots,n\},|S|\leq r\} \sqcup\{1,\ldots,n\}\quad\text{and}\quad \mu(S,i)=\frac{1_{i\in S}}{|S|}\nu(S)\;,\]
and for any $S,i\in\mX$, $\mA(S)=\F_q^S$ and $\mA(i)=\F_q$, and finally $D(S,i,a,b)=M(S,a)1_{a_i=b}$. 
\end{definition}

To state the sense in which this nonlocal game is equivalent to quantum soundness of $\code$ we need to introduce a notion of \emph{robustness} of a nonlocal game. This definition is standard in the literature on self-testing\tnote{is it; give a ref?}.


\begin{definition}[Robust game]
Given a game $G$, a function $\delta:[0,1]\to[0,1]$, and a distribution $\nu$ on $\mX$ we say that $G$ is \emph{$(\delta,\nu)$-robust} if any synchronous strategy for $G$ that succeeds with probability at least $1-\eps$ in $G$, for some $\eps\geq 0$, is
 $(\delta(\eps),\nu)$-close to a perfect strategy.
\end{definition}

Note that in the definition $\nu$ need not be the marginal of the game distribution $\mu$. In particular, we will often consider $\nu$ that is supported on a strict subset of the support of $\mu$. 

We now state the main result of the section. 

\begin{proposition}\label{prop:sound-game}
Let $\code$ be an $[n,k,d]_q$ linear code and $M$ an $r$-local tester for $\code$ with distribution $\nu$. Let $\delta,\delta':[0,1]\to[0,1]$. Then the following hold:
\begin{enumerate}
\item If $G_{\code,M}$ is $(\delta',\nu)$-robust for $\nu$ the uniform distribution on $\{1,\ldots,n\}\subseteq \mX$, and $(\mC,M)$ is Abelian, then $M$ has quantum soundness $\delta''$, for some $\delta''(\eps) = O(\delta'(\sqrt{\eps}))$. 
\item If $M$ has quantum soundness $\delta$ then $G_{\code,M}$ is $(\delta'',\nu)$-robust, for some $\delta''(\eps)=O({\delta(2\eps)})$ and $\nu$ the uniform distribution on $\{1,\ldots,n\}\subseteq \mX$. 
\end{enumerate}
\end{proposition}

We prove the proposition in Section~\ref{sec:game-proof}. Before doing so, we introduce some simple tools. 

\subsection{Preliminary lemmas}

We give some lemma that will be used in the proof of Proposition~\ref{prop:sound-game}. The lemma are well-known; we include proofs for the specific statements that we use. 

In Definition~\ref{def:close} closeness is measured in the $L_2$ sense. The first lemma gives a consequence for distance measured in an $L_1$ sense. 


\begin{lemma}\label{lem:l1-l2}
\hnote{$(\eps,\mu)$-closeness needs the measurements to be superscripted by questions}\tnote{fixed}
Let $\{P_a^i\}$ and $\{Q_a^i\}$ be two families of projective measurements that are $(\eps,\mu)$-close. Then 
\begin{equation}\label{eq:l1-l2}
\Es{i\in\mI} \sum_{a\in \mA(i)} \tau\big(|P_a-w^*Q_aw|\big) \,\leq\, \eps+ 2 \sqrt{\eps}\;.
\end{equation}
\end{lemma}

\begin{proof}
Using the triangle inequality, 
\begin{align}
\Es{i} \sum_a \tau\big(|P^i_a - w^* Q^i_a w|\big) &\leq\, \Es{i}\sum_a \Big(\tau\big(|(P^i_a-(P^i_a)^2)|\big) + \tau\big(|P_a(P^i_a-w^*Q^i_aw)|\big) \notag\\
&\qquad\qquad+ \tau\big(|(P^i_a-w^*Q^i_aw)w^*Q^i_aw|\big) \notag \\
 \label{eq:lem:l1-l2}
&\qquad +\tau\big(| (w^*Q^i_aw^*wQ^i_aw-w^*Q^i_aw)|\big)\Big)\;.
\end{align}
The first term on the right-hand side is zero, because $P^i$ is assumed projective. The terms in the middle are bounded using H\"older's inequality:
\begin{align*}
\Es{i}\sum_a  \tau\big(|P^i_a(P^i_a-w^*Q^i_aw)|\big) &\leq \Es{i} \sum_a \|P^i_a\|_2 \, \, \|P^i_a-w^*Q^i_aw\|_2\\
&\leq \Big(\Es{i}\sum_a \|P^i_a\|^2_2\Big)^{1/2}\Big( \Es{i}\sum_a  \|P^i_a-w^*Q^i_aw\|_2^2 \Big)^{1/2}\\
&\leq \sqrt{\eps}
\end{align*}
by closeness. The second term of~\eqref{eq:lem:l1-l2} is bounded in a similar fashion.
Finally the last term of~\eqref{eq:lem:l1-l2} can be bounded as 
\begin{align*}
\Es{i}\sum_a \tau\big(| w^*Q^i_aw^*wQ^i_aw-w^*Q^i_aw|\big) &= \Es{i}\sum_a \tau\big( (w^*Q^i_a(I - w^*w)Q^i_aw)\big)\\
&=  \tau\Big( (I-w^*w)\Big(\Es{i}\sum_a Q^i_aww^* Q^i_a\Big)\Big)\\
&\leq \tau(I-w^*w) \,\, \Big\|\Es{i}\sum_a Q^i_aww^* Q^i_a\Big\|\\
&\leq \eps\;.
\end{align*}
\end{proof}




The next lemma shows that two strategies for the same game $G$ that are close according to Definition~\ref{def:close} have a close value. 

\begin{lemma}\label{lem:close-value}
Let $G=(\mX,\mu,\mA,D)$ be a game and $\strategy=\{P^x_a\}$ and $\strategy'=\{Q^x_a\}$ strategies on $\mM$ and $\mN$ respectively such that $\{P^x_a\}$ and $\{Q^x_a\}$ are $(\eps,\mu)$-close. Then 
\[ \big|\omega(G;\strategy) - \omega(G;\strategy')\big|\,\leq\, 8\sqrt{\eps} \;.\]
\end{lemma}

\begin{proof}
By definition, there exists a projection $P \in \mM_\infty$ and a partial isometry $w \in P \mM_\infty I_\mM$ such that $\mN = P \mM_\infty P$ and
\begin{align*}
\omega(G;\strategy') &= \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y)  \tau\big( Q^x_a \, Q^y_b \big)\\
&=  \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y)  \tau\big( w^* Q^x_a w\, w^* Q^y_b w\big)\\
&\qquad\qquad+  \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y)  \tau\big( w^* Q^x_a (P - w\, w^* ) Q^y_b w\big) \\
&\qquad\qquad+ \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y)  \tau\big(Q^x_a  Q^y_b (P-ww^*)\big)~.
\end{align*}
Here we used the fact that $Q^x_a \in \mN$ so $P Q^x_a P = Q^x_a$ for all $x,a$. 
The second and third term on the right-hand side can be bounded as
%\begin{align*}
%\Big|\Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y)  \tau\big( w^* Q^x_a (P - w\, w^* ) Q^y_b w\big)\Big|
%&=\Big| \tau\Big(  (P - w\, w^* )\Big( \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) Q^y_b ww^* Q^x_a \Big)\Big)\Big|\\
%&\leq \tau(P-ww^*) \Big\|\Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) Q^y_b ww^* Q^x_a \Big\|\\
%&\leq \eps\;,
%\end{align*}
%where the first inequality is by H\"older's inequality and the last inequality uses the definition of closeness to bound the first term. To bound the second term on the right-hand side, we write it as $\|A\circ B\|$, with $\circ$ the Hadamard product, and use  $\|A\circ B\| \leq \max_{i,j} |A_{i,j}|\|B\|$. Here $A = \sum_{a,b} D(a,b) P_{a,b}$, with $P_{a,b} = \sum_{i,j} \ket{u_{i,a}} \bra{v_{j,b}}$ with $\ket{u_{i,a}}$ a basis for the range of $Q^x_a$ and $\ket{v_{j,b}}$ for the range of $Q^y_b$, and $B=\sum_{a,b} Q^y_b ww^* Q^x_a = ww^*$.  \hnote{not quite sure about this proof... is the Hadamard product well defined in infinite dimensions? What is $D(a,b)$? A bit confused...}
%\hnote{here's an alternate proof:}
\begin{align*}
\Big|\Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) & \tau\big( w^* Q^x_a (P - w\, w^* ) Q^y_b w\big)\Big|\\
&\leq \Es{(x,y)\sim\mu} \Big | \tau\big( \sum_{a,b} D(a,b,x,y)   Q^y_b w w^* Q^x_a (P - w\, w^* ) \big) \Big | \\
&\leq \sqrt{ \tau((P - ww^*)^2)} \cdot \sqrt{\Es{(x,y)\sim\mu} \tau\big( \big| \sum_{a,b} D(a,b,x,y)   Q^x_a w w^* Q^y_b \big|^2 \big) } \\
&\leq \sqrt{\eps}\sqrt{ \Es{(x,y)\sim\mu} \tau\big( \sum_{a,b} D(a,b,x,y)   Q^y_b ww^* Q^x_a w w^* Q^y_b \big) } \\
&\leq \sqrt{\eps}\sqrt{ \Es{(x,y)\sim\mu}  \sum_{a,b}  \tau\big(Q^y_b ww^* Q^x_a w w^* Q^y_b \big) }  \\
&=\sqrt{\eps}\sqrt{ \Es{(x,y)\sim\mu}  \sum_{b}  \tau\big(Q^y_b ww^* \big) } \\
&\leq \sqrt{\eps}\;.
%&=\Big| \tau\Big(  (P - w\, w^* )\Big( \Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) Q^y_b ww^* Q^x_a \Big)\Big)\Big|\\
%&\leq \tau(P-ww^*) \Big\|\Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) Q^y_b ww^* Q^x_a \Big\|\\
%&\leq \eps\;,
\end{align*}
The third line is due to Cauchy-Schwarz and Jensen's inequality, where $|A|^2=A^*A$. The fourth line uses that $P - ww^*$ is a positive operator with operator norm at most $1$ for the first term, and that for fixed $x,y$, the measurements $\{ Q^x_a \}_a$ and $\{Q^y_b\}_b$ are projective. The fifth line is due to $D(x,y,a,b) \in \{0,1\}$. The sixth line is due to $\sum_a Q^x_a = I_\mN$. The seventh line is due to $\sum_a Q^y_b = I_\mN$.

For $x\in \mX$ such that $\mu(x)\neq 0$, denote by $\mu_x$ the (symmetrized) conditional distribution $\mu_x(y)=\frac{1}{2}(\mu(x,y)+\mu(y,x))/\mu(x)$. Then using the above
\begin{align*}
\big|\omega(G;\strategy) - \omega(G;\strategy')\big|
 &\leq 2\sqrt{\eps}+ \Big|\Es{(x,y)\sim\mu} \sum_{a,b} D(a,b,x,y) \big( \tau\big( P^x_a \, P^y_b \big)-\tau\big( w^* Q^x_a w\, w^* Q^y_b w\big)\big)\Big|\\
&\leq  2\sqrt{\eps}+ \Big|\Es{x\sim\mu} \sum_{a}  \tau\Big( \big(P^x_a-w^* Q^x_aw\big) \, \Big( \Es{y\sim \mu_x} \sum_b D(a,b,x,y) P^y_b \Big)\Big)\Big|\\
&\qquad+ \Big|\Es{y\sim\mu} \sum_{b}  \tau\Big(\Big( \Es{x\sim \mu_y} \sum_a D(a,b,x,y) w^* Q^x_a w\Big) \big(P^y_b-w^*Q^y_bw\big) \, \Big)\Big|\\
&\leq 2\sqrt{\eps}+2\Es{x\sim\mu} \sum_{a}  \tau\big(\big| P^x_a-w^*Q^x_aw\big|\big) \\
&\leq 2\sqrt{\eps}+2(\eps + 2\sqrt{\eps}) \leq 8\sqrt{\eps}\;,
\end{align*}
where the third line uses $\tau(AB)\leq\tau(|A|)\|B\|$ and the last line is by~\eqref{eq:l1-l2}.% and Jensen's inequality.
\end{proof}

Our final lemma is an application of \emph{orthonormalization}, which transforms a nearly-orthogonal measurement to a nearby orthogonal measurement. See e.g.~\cite{kempe2011parallel,ji2020quantum} or~\cite[Theorem 1.2]{de2021orthogonalization} for the version that we use here. 
	
\begin{lemma}\label{lem:pull-back}
Let  $(\mM,\tau^\mM)$ be a tracial von Neumann algebra, $P\in\mM_\infty$ a projection of finite trace, $\mN=P\mM_\infty P$ and $\tau^\mN=\tau_\infty/\tau_\infty(P)$, and $w\in P \mM_\infty \Id_\mM$ a partial isometry. Let 
\[ \eps = \max\big\{ \tau^\mM\big(\Id_\mM - w^* w\big)\,,\;\tau^\mN\big( P- w w^*\big)\big\}\;.\] 
 Then for any projective measurement $\{P_a\}_{a \in \mA}$ on $\mN$, there is a projective measurement $\{Q_a\}_{a \in \mA}$ on $\mM$ such that 
\begin{equation}
\label{eq:pull-back} \sum_{a \in \mA} \big\| Q_a - w^* P_a w\big\|_2^2 \,\leq \ 56\eps\;.
\end{equation}
\end{lemma}	

\begin{proof}
If $\eps\geq \frac{1}{2}$ the conclusion is trivial (for a suitably large implicit constant in the $O(\cdot)$ notation in \eqref{eq:pull-back}), so assume $\eps<\frac{1}{2}$. 
Define 
\[\tilde{Q}_a = w^* P_a w  + \frac{1}{|\mA|}\big(\Id_\mM - w^* w\big) \in \mM\;.\]
Then $\{\tilde{Q}_a\}$ is a POVM on $\mM$. Moreover, 
\begin{align*}
\sum_a \tau^\mM \big( \tilde{Q}_a^2 \big) &\geq \sum_a \tau^\mM \big( \big(w^* P_a w \big)^2 \big) \\
&= \sum_a \tau^\mM \big(  w^* P_a w w^*P_a w \big)\\
&= \sum_a \tau^\mM \big(  w^* P_a  P P_a w \big) - \sum_a \tau^\mM \big( w^* P_a  ( P - w w^*) P_a w \big)\\
\intertext{
\hnote{I don't get this next line... how did $\tau_\infty$ show up?}\tnote{By definition, $\mM$ is seen as a sub-algebra of $\mM_\infty$, and $\tau_\infty$ restricted to that sub-algebra is $\tau^\cM$. So, whenever $M\in \mM$, $\tau^\mM(M)=\tau_\infty(\mM)$ is a legal ``shortcut'' in the writing. It's this sentence about the ``corner'' in the prelims...should we add something more explicit? Or explain this line here more, since it's the first time we make the manipulation? }
}
&\geq 1 - \eps -  \tau_\infty\Big(\big( P - w w^*\big)\Big(\sum_a  P_a w w^* P_a\Big)\Big)\\ 
&\geq 1- \eps- \tau_\infty\big( P- w w^*\big)\;,
\end{align*}
where the fourth line uses that $P_aPP_a=P_a$, $\sum_a P_a = \Id_\mN$ and the definition of $\eps$ for the first term, and cyclicity of the trace for the second, and the last uses $\|ww^*\|,\|\sum_a P_a\|_\infty\leq 1$. By assumption, 
\begin{align*}
\tau_\infty\big( P- w w^*\big) \,\leq\, \eps\, \tau_\infty(P)\,\leq \frac{\eps}{1-\eps}\;.
\end{align*}
where the last inequality is because by definition, $\tau^N(P)=1$, thus
\[1-\eps \,\leq\, \tau^\mN(ww^*) \,=\, \frac{\tau_\infty(ww^*)}{\tau_\infty(P)}\,=\, \frac{\tau_\infty(w^*w)}{\tau_\infty(P)}  \,\leq\, \frac{1}{\tau_\infty(P)}\]
since $\tau_\infty(w^* w) = \tau^\mM(w^* w)$ and $w^*w\leq I_\mM$. Overall, 
\[ \sum_a \tau^\mM \big( \tilde{Q}_a^2 \big) \,\geq\, 1-\eps-\frac{\eps}{1-\eps}\,\geq\, 1-3\eps\;.\]
To conclude we apply~\cite[Theorem 1.2]{de2021orthogonalization} to obtain a projective measurement $\{Q_a\}$ on $\mM$ such that 
\begin{equation*}
\sum_a \big\|{Q}_a - \tilde{Q}_a \big\|^2_2 \,=\, 27\eps\;.
\end{equation*}
Finally,
\begin{align*}
\sum_a \big\|{Q}_a - w^*{P}_a w\big\|^2_2 &= \sum_a \Big\|{Q}_a - \tilde{Q}_a  + \frac{1}{|\mA|}\big(I_\mM - w^* w\big) \Big\|^2_2\\
&\leq  \sum_a 2\big\|{Q}_a - \tilde{Q}_a\big\|_2^2  + 2\frac{1}{|\mA|}\big\|I_\mM - w^* w\big\|_2^2 \\
&\leq 54 \eps + 2 \tau^\mM( (I_\mM - w^* w)^2 ) \\
&\leq 54 \eps + 2 \tau^\mM(I_\mM - w^* w ) \\
&\leq 56 \eps\;,
\end{align*}
where the second line is by the triangle inequality, the fourth line is due to the fact that $I_\mM - w^* w$ is positive and has operator norm at most $1$, and the last line is by $\tau^\mM(I_\mM - w^* w ) \leq \eps$.
\end{proof}




\subsection{Proof of Proposition~\ref{prop:sound-game}}
\label{sec:game-proof}

We prove the proposition. 

\begin{proof}[Proof of Proposition~\ref{prop:sound-game}]
We start with the first assertion. Suppose that $G_{\code,M}$ is $\delta'$-robust, for some function $\delta'$. Let $(\mM,A)$ be be an $\eps$-local presentation of $(\code,M)$, and for each $S\subseteq\{1,\ldots,n\}$ such that $|S| \leq r$, $\{B^{S,i}\}_{i\in S}$ the commuting family of projective measurements promised by the definition. Then for every $S$ there is a projection $P^S \in \mM_\infty$ and an isometry $w^S\in P^S \mM_\infty I_\mM$ such that 
\[ \Es{S \sim \nu} \Es{i\in S} \sum_{a \in \F_q} \big\| A^i_a - (w^S)^* B^{S,i}_{a}w^S \big\|_2^2 \,\leq\,\eps\;.\]
\tnote{adding this to break up the proof a little:}The key step consists in proving the following claim. 

\begin{claim}\label{claim:sound-game-1}
Let $D$ be the decision predicate associated with the game $G_{\code,M}$.
There is a family  $\{P^S_a\}_{a\in \F_q^S}$  of projective measurements on $\mM$, for every  $S\subseteq\{1,\ldots,n\}$ such that $|S| \leq r$, such that
\begin{equation}
 \sum_{S,i} \mu(S,i) \sum_{a\in \F^S_q}\sum_{b\in\F_q} D(S,i,a,b) \tau\big(  P^S_a  A^i_{b}\big) \,\geq \,1-O(\sqrt{\eps})\;.\label{eq:s-g-4}
\end{equation}
\end{claim}

\begin{proof}
For any $a\in\F^S_q$ let $\tilde{P}^S_a = \prod_{i\in S} B^{S,i}_{a_i}$ (since the measurements $\{B^{S,i}\}_i$ are pairwise commuting, the order of the product does not matter). Then $\{\tilde{P}^S_a\}_{a\in\F_q^S}$ is a projective measurement such that for any $i\in S$ and $b\in \F_q$, 
\[ \sum_{a\,:\, a_i=b} \tilde{P}^S_a \,=\, B^{S,i}_b\;.\]
Using this identity, \hnote{I don't get what's happening in these next few lines... what happened to the product over $B^{S,i}_{a_i}$ in the first line?}\tnote{I added the preceding centered equation to explain, is it ok?}
\begin{align}
\Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big(  (w^S)^* \tilde{P}^S_a w^S \, A^i_{a_i}\big) 
&= \Es{S\sim \nu} \Es{i\in S} \sum_{b\in \F_q}\tau\big(  (w^S)^* B^{S,i}_b w^S\, A^i_{b}\big)\notag \\
&= \Es{S\sim \nu} \Es{i\in S} \frac{1}{2}\Big(\tau\big((w^S)^*w^S\big) + \tau(1) - \sum_{b\in \F_q} \big\|  (w^S)^* B^{S,i}_b w^S - A^i_{b}\big\|_2^2\Big) \notag\\
&\geq \,\frac{1}{2}(1-\eps+1-\eps)\;.\label{eq:s-g-1}
\end{align}
Starting from the $\{\tilde{P}^S_a\}$, let $\{P^S_a\}$ be the family of projective measurements on $\mM$ that is promised by Lemma~\ref{lem:pull-back}. By a simple averaging argument,
\begin{equation}\label{eq:s-g-1b}
\Es{S\sim \nu}\sum_{a\in \F_q^S} \big\| P^S_a - (w^S)^* \tilde{P}^S_a (w^S)\big\|_2^2 \,=\, O(\eps)\;. 
\end{equation}
We can write
\begin{align}
\Big|\Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big( P^S_a A^i_{a_i}\big)
&- \Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big( (w^S)^* \tilde{P}^S_a (w^S)A^i_{a_i}\big)\Big|\notag\\
&= \Big| \Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big(\big(P^S_a - (w^S)^* \tilde{P}^S_a (w^S)\big)A^i_{a_i}\big)\Big|\notag\\
&\leq \Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big(\big|(w^S)^* \tilde{P}^S_a (w^S)-P^S_a\big|\big)\notag\\
&= O(\sqrt{\eps})\;,\label{eq:s-g-2}
\end{align}
where the inequality uses H\"{o}lder's inequality with $\|A^i_a\|\leq 1$ and the last line is by Lemma~\ref{lem:l1-l2} and~\eqref{eq:s-g-1b}.
Using the definition of $G_{\code,M}$, we have shown that \hnote{I think this part requires a little more explanation...for example this is the first time the decision predicate $D(S,i,a,b)$ has shown up in this proof.}\tnote{added a couple lines}
\begin{align*}
 \sum_{S,i} \mu(S,i) \sum_{a\in \F^S_q}\sum_{b\in\F_q} D(S,i,a,b) \tau\big(  P^S_a  A^i_{b}\big)
&=  \Es{S\sim\nu} \Es{i\in S} \sum_{a\in \F^S_q}  \tau\big(  P^S_a  A^i_{a_i}\big)\\
&\geq O\big(\sqrt{\eps}\big) - \Es{S\sim \nu} \Es{i\in S} \sum_{a\in \F_q^S} \tau\big( (w^S)^* \tilde{P}^S_a (w^S)A^i_{a_i}\big)\\
&= 1-O\big(\sqrt{\eps}\big)\;,
\end{align*}
where the first line uses the definition of $\mu(\cdot,\cdot)$, the second line uses~\eqref{eq:s-g-2} and the last uses~\eqref{eq:s-g-1}. 
\end{proof}

Claim~\ref{claim:sound-game-1} shows that $\omega(G_{\code,M};\strategy)\geq 1-\eps'$ for $\strategy$ the strategy with measurements $\{A^i_b\}$ and $\{P^{S}_a\}$ and some $\eps'=O(\sqrt{\eps})$. Using the definition of robustness we deduce that $(\mM,A,P)$ \hnote{what is this triple?}\tnote{$A$ and $P$ are defined just above. $C$ and $Q$ are any other measurements. You think we should introduce specific notation?} is $(\delta'(\eps'),\nu)$-close to a perfect strategy $(\mN,C,Q)$ \hnote{same question} for $G_{\code,M}$. Since $\nu$ is uniform on $\{1,\ldots,n\}$ we specialize to the $A$ measurements; using the definition of closeness there exists a projection $P\in \mM_\infty$ such that $\{C^i\}_a \subseteq P\mM_\infty P$ and $\Es{i}\sum_a \|A^i_a-w^* C^i_a w \|_2^2 \leq 2\delta'$, and moreover $\{C^i_a\}$ satisfy that for any $S$ in the support of $\mu$, $\{C^i_a\}$ pairwise commute for $i\in S$. Using the assumption that $(\code,M)$ is Abelian, all the $\{C^i_a\}$ commute and form a representation of $\code$.

Now we show the second assertion. Suppose that $M$ has quantum soundness $\delta$.
Let $\strategy=(\mM,A,P)$ be a strategy for $G_{\code,M}$ on $(\mM,\tau)$ that succeeds with probability at least $1-\eps$. This can be reformulated as 
\begin{equation}
 \sum_{(S,i)} \mu(S,i) \sum_{a\in \F_q^s}\sum_{b\in\F_q} D(S,i,a,b) \tau\big(  P^S_a  A^i_{b}\big) \,\geq \,1-\eps\;.\label{eq:s-g-3a}
\end{equation}
For each $S$ and $i\in S$, let $B^{S,i}_b = \sum_{a:a_i=b} P^S_a$. Then using the definition of $\mu$ and $D$, rewriting~\eqref{eq:s-g-3a} immediately gives
\begin{equation}
 \Es{S\sim \nu} \Es{i\in S} \sum_{b\in\F_q} \big\| A^i_{b} - B^{S,i}_b\big\|_2^2 \,\leq \,2\eps\;.\label{eq:s-g-3}
\end{equation}
Thus $(\mM,A)$ is an $\eps'$-local presentation of code, for $\eps'=2\eps$. Using quantum soundness, there is a representation $(\mN,C)$ of $\code$ that is $\delta'$-close to $(\mM,A)$, for $\delta'=\delta(\eps')$. 

For every $S$, let $Q^S_a = \prod_{i\in S} C^i_{a_i}$, which is a projective measurement on $\mN$. It is easy to verify that $(\mN,C,Q)$ is a perfect strategy in $G_{\code,M}$. Using the definition of $\nu$, it follows that   $(\mN,B,Q)$ is $O({\delta'})$-close to $(\mM,A,P)$.

%Moreover,
%\begin{align}
%\Es{S\sim \nu} \sum_{a\in\field^k} \big\| P^S_a - w^* Q^S_a w\big\|_2^2
%&=2 - 2\Es{S\sim \nu} \sum_{a\in\field^k} \tau\Big( \prod_i B^{S,i}_{a_i} w^* \prod_i C^{i}_{a_i}w\big)\;.\label{eq:s-g-4}
%\end{align}
%Applying a simple inductive argument, using Lemma~\ref{lem:l1-l2} we get that \tnote{This needs a little more detail}
%\begin{align*}
%\Big|\Es{S\sim \nu} \sum_{a\in\field^k} \tau\Big( \prod_i B^{S,i}_{a_i} w^* \prod_i C^{i}_{a_i}w\big) - \Es{S\sim \nu} \sum_{a\in\field^k} \tau\Big( \prod_i B^{S,i}_{a_i}  \prod_i B^{S,i}_{a_i}\big)\Big| &= O\big(r\sqrt{\delta'}\big)\;.
%\end{align*}
%Since the second term on the left-hand side above equals $1$, plugging back into~\eqref{eq:s-g-4} it follows that   $(\mN,B,Q)$ is $O(r\sqrt{\delta'})$-close to $(\mM,A,P)$.
\end{proof}




\section{Main result}
\label{sec:main}

In this section we focus on binary codes only, see Section~\ref{sec:pbt} for the case of fields over $\F_q$ for $q$ a power of $2$. 

We start by defining a notion of ``qubit test,'' and state an interesting consequence of the definition in terms of dimension tests. In Section~\ref{sec:braiding} we describe a test, the \emph{braiding test}, that can be constructed from any linear code and in Section~\ref{sec:main} we state and prove our main result, which is that whenever the braiding test is based on a quantum sound code then it is a qubit test. 

\subsection{Qubit tests}

Let $\code$ be an $[n,k,d]$ linear code and $M$ an $r$-local tester for $\code$. Recall that for a projective measurement $P = \{P_a\}_{a \in \F_2^k}$, we use $\widehat{P}(b)$ to denote the corresponding observable (see \Cref{sec:measurements}). For binary outcome measurements $P = \{ P_0, P_1\}$, we write $\widehat{P}$ to denote $P_0 - P_1$. 

\begin{definition}
Let $k\in \N$ and $\delta:[0,1]\to\R_+$. 
A \emph{$(k,\delta(\eps))$-qubit test} is a synchronous game $G=(\mX,\mu,\mA,D)$ such there are two sets $S_X,S_Z\subseteq \field^k$ \tnote{adding:}that are both generating sets and an injection $\phi:(\{X\}\times S_X) \cup (\{Z\}\times S_Z) \to \mX$ such that $\mA(\phi({X},a))=\mA(\phi({Z},b))=\field$ for all $a\in S_X$, $b\in S_Z$ and such that the following holds:
\begin{itemize}
\item (Completeness:) There is a synchronous strategy $(\mM,P)$ for $G$ on $\mM=M_{2^{k}}(\C)$ that succeeds with probability $1$ in $G$ and is such that $\widehat{P}^{\phi({W},a)} = \sigma^W(a)$ for every $W\in\{X,Z\}$ and $a\in S_W$. \hnote{What does $\widehat{P}$ refer to here? Is it the observable corresponding to a projective measurement $P$ for question $\phi(W,a)$ that's part of the synchronous strategy?}\tnote{yes}
\item (Soundness:) \tnote{added:}Let $\mu'$ denote the (renormalized) restriction of (the marginal of) $\mu$ to the image of $\phi$ in $\mX$.
Any synchronous strategy in $(\mM,\tau)$ for $G$ that succeeds with probability $1-\eps$ for some $\eps\geq 0$ is $(\delta(\eps),\tilde{\mu})$-close \hnote{in light of the next remark, this should also specify the distribution over which the closeness is measured?}\tnote{added} to a strategy on some algebra $(M_{2^{k}}(\C)\otimes \mN,\tr\otimes \tau')$ where $(\mN,\tau')$ is a tracial sub-algebra of $\mM_\infty$ and such that
\[\widehat{P}^{\phi({W},a)} = \sigma^W(a)\otimes \Id_\mN\;.\]
\hnote{Technically, for this to adhere to the definition of closeness, the ``bigger'' algebra needs to be a subalgebra of $\mM_\infty$. Is this obvious?}\tnote{added}
\end{itemize}
\end{definition}

\tnote{commented out remark about special case where $S_X,S_Z=\emptyset$}
%\begin{remark}
%The definition allows ``trivial'' settings for the sets $S_X,S_Z$, e.g.\ $S_X=S_Z=\emptyset$. In this case, a strategy for $G$ may not give direct access (through specific questions) \hnote{should have some prior text explaining what ``direct access to a Pauli observable'' means} to any Pauli observable and the soundness condition is trivial. As soon as e.g. $S_X,S_Z$ both contain the basis elements $e_1,\ldots,e_k \in \field^k$ then the definition is non-trivial. Moreover, the notion of closeness provided by the soundness statement is averaged over the marginal of the game distribution $\mu$. Therefore, the measurements associated with questions in the range of $\phi$ are close to the ideal measurements only inasmuch the corresponding questions have non-trivial probability of being asked in $G$. 
%\end{remark}

The next proposition states a simple consequence of a qubit test, which is that strategies with a high enough success probability must have a large dimension. This consequence is used in~\cite{ji2020mip}. 

\begin{proposition}
\label{prop:dim-test}
Let $G = (\mX,\mu,\mA,D)$ denote a $(k,\delta(\eps))$-qubit test \hnote{what is weird here is that the argument doesn't seem to rely on any assumptions on the sets $S_X, S_Z$, nor that the closeness holds with respect to a reasonable distribution. I suspect somehow the definition of soundness might be a little too strong?}. Then all synchronous strategies $\strategy$ in $(\mM,\tau)$ for $G$ that succeed with probability $1 - \eps$ must satisfy 
\[
\dim(\mM) \geq \Big( 1 + O(\sqrt{\delta(\eps)}) + \frac{\delta(\eps)}{1 - \delta(\eps)}\Big)^{-1} 2^k~.
\]
\end{proposition}
\begin{proof}
If $\mM$ is infinite-dimensional, then we are done. Suppose instead it were finite-dimensional. Then \hnote{need a reference here?} $\mM$ must be \hnote{isomorphic to?} a direct sum of finite-dimensional matrix algebras. \hnote{Does this WLOG need justification?}\tnote{I think all the above are fine, no explanation needed.}  Without loss of generality we assume that $\mM = M_{d}(\C)$ with the dimension-normalized trace $\tau = \frac{1}{d} \Tr$. 

By the soundness property of qubit tests, the strategy $\strategy$ is $(\delta(\eps),\tilde{\mu})$-close \hnote{need to fill in what $\ldots$ is}\tnote{added} to a strategy $\strategy'$ on an algebra $(M_{2^k}(\C) \otimes \mN,\tr_{2^k} \otimes \tau')$ for some tracial algebra $(\mN,\tau')$ where $\tr_{2^k} = 2^{-k} \Tr$. For notational brevity we write $\mR = M_{2^k}(\C) \otimes \mN$ and $\tau^{\mR} = \tr_{2^k} \otimes \tau'$. By definition there exists a projection $P \in \mM_\infty$ of finite trace and a partial isometry $w \in P \mM_\infty 1_\mM$ satisfying
\begin{enumerate}
	\item $\mR = P \mM_\infty P$. \hnote{does this make sense? should be ``isomorphic to'' instead?}\tnote{I think it's fine; the definition of closeness says ``equal''}
	\item $\max \left \{ \tau(1_\mM - w^* w), \tau^{\mR} (P - w w^*) \right \} \leq \delta(\eps)$.
	\item $\tau^{\mR} = \tau_\infty/\tau_\infty(P)$.
\end{enumerate}
%For $W \in \{X,Z\}$ and 
For $u \in \F_2^k$ let $\sigma^Z_u$ denote the projection
\[
	\sigma^Z_u = 2^{-k} \sum_{a \in \F_2^k} (-1)^{a \cdot u} \sigma^Z(a)~.
\]
It is easy to verify that $\{\sigma^Z_u \otimes I_\mN \}_{u \in \F_2^k}$ is a projective measurement in $\mR$ and furthermore $\tau^{\mR}(\sigma^Z_u \otimes I_\mN) = 2^{-k}$. Applying \Cref{lem:pull-back} we get that there exist projective measurement $\{Q_u\}_{u \in \F_2^k}$ on $\mM$ such that
\[
	\sum_u \| Q_u - w^* (\sigma^Z_u \otimes I_\mN) w \|_2^2 \leq 56\, \delta(\eps)~.
\]
Applying \Cref{lem:l1-l2} we get
\[
	\sum_u \tau \Big ( \Big| Q_u - w^* (\sigma^Z_u \otimes I_\mN) w\Big| \Big) \leq O(\sqrt{\delta(\eps)})~.
\]
Then we have
\begin{align*}
	\sum_u \Big| \tau(Q_u) - 2^{-k} \Big| &\leq \sum_u \Big | \tau(w^* (\sigma^Z_u \otimes I_\mN) w) - 2^{-k} \Big| + \tau \Big ( \Big| Q_u - w^* (\sigma^Z_u \otimes I_\mN) w\Big| \Big) \\
	&= O(\sqrt{\delta(\eps)}) + \sum_u \Big | \tau_\infty (w w^* (\sigma^Z_u \otimes I_\mN)) - 2^{-k} \Big| \\
	&= O(\sqrt{\delta(\eps)}) + \sum_u \Big | \tau_\infty (P (\sigma^Z_u \otimes I_\mN)) - 2^{-k} \Big| + \Big | \tau_\infty((P - ww^*)(\sigma^Z_u \otimes I_\mN)) \Big|
%	&\leq O(\sqrt{\delta(\eps)}) + \sum_u \| P - ww^* \| \tau_\infty( |  \sigma^Z_u \otimes I_\mN |) 
\end{align*}
Notice that $\tau_\infty (P (\sigma^Z_u \otimes I_\mN)) = \tau_\infty (\sigma^Z_u \otimes I_\mN) = 2^{-k}$, and that $ww^* \leq P$ and thus $\tau_\infty((P - ww^*)(\sigma^Z_u \otimes I_\mN))$ is a nonnegative real number. Therefore the sum in the last line simplifies to
\[
\sum_u \tau_\infty((P - ww^*)(\sigma^Z_u \otimes I_\mN)) = \tau_\infty((P - ww^*) P) = \tau_\infty(P - ww^*) \leq \tau_\infty(P) \cdot \delta(\eps)~.
\]
On the other hand the proof of \Cref{lem:pull-back} shows that $\tau_\infty(P) \leq \frac{1}{1 - \delta(\eps)}$, and thus 
\[
\sum_u \Big| \tau(Q_u) - 2^{-k} \Big| \leq O(\sqrt{\delta(\eps)}) + \frac{\delta(\eps)}{1 - \delta(\eps)}~.
\]
By averaging, there exists a $u \in \F_2^k$ such that
\[
\tau(Q_u) = \frac{1}{d} \Tr(Q_u) \leq  \Big( 1 + O(\sqrt{\delta(\eps)}) + \frac{\delta(\eps)}{1 - \delta(\eps)}\Big) 2^{-k}~.
\]
Rearranging, this implies that $d$, the dimension of $\mM$, satisfies
\[
	d \geq \Big( 1 + O(\sqrt{\delta(\eps)}) + \frac{\delta(\eps)}{1 - \delta(\eps)}\Big)^{-1} 2^k
\]
as desired.
\end{proof}



\subsection{The braiding test}

We introduce our main test, the \emph{braiding test}, which can be based on any linear code $\code$ and tester $M$ for it. Before we state the test, we recall the classic \emph{commutation} and \emph{anticommutation} games. 

\paragraph{Commutation game.}
We call \emph{commutation game} the game defined in~\cite[Section 3.1]{de2022spectral}. For convenience we change the notation slightly and denote $x_{X,0}, x_{Z,0} \in \mX_{com}$ the two special questions, $x_{com,1}$ and $x_{com,2}$ respectively. 

\paragraph{Anti-commutation game.}
We call \emph{anti-commutation game} the game defined in~\cite[Section 3.2]{de2022spectral}. For convenience we change the notation slightly and  denote $x_{X,1}, x_{Z,1} \in \mX_{anticom}$ the two special questions, $x_{anticom,1}$ and $x_{anticom,2}$ respectively. 

\paragraph{The braiding test.}
Let $\code$ be an $[n,k,d]_2$ linear code and $M$ an $r$-local tester for $\code$. The braiding test constructed from $\code$ and $M$ is described in Figure~\ref{fig:braiding-test}. Informally, the test combines two independent copies of the code test from Section~\ref{} with appropriate commutation and anti-commutation games that will force any successful strategy in the game to be close, in some sense, to a representation of the Pauli group generated by observables $\sigma^X(a)$ and $\sigma^Z(b)$, $a,b\in \F_2^k$. 

\begin{figure}[!htbp]
  \centering
  \begin{gamespec}
Let $M$ be an $r$-local tester with distribution $\nu$ for the $[n,k,d]$ code $\code$.  Execute either of the following tests with probability $1/3$ each. 
    \begin{enumerate}
      \setlength\itemsep{1pt}
    \item (\textbf{Code test}) Sample $W\in \{X,Z\}$ uniformly at random, a set $S \subseteq \{1,\ldots,n\}$ from the distribution $\nu$, and an index $i \in S$ uniformly at random. 
    %and $\rand$ a setting for $M$'s random tape at random. Let $S=M(\rand)\subseteq\{1,\ldots,n\}$. Sample $i\in S$ uniformly at random. 
    Send $(W,S)$ to $\alice$ and $(W,i)$ to $\bob$. Receive $a\in \field^S$ from $\alice$ and $b\in \field$ from $\bob$. Accept if and only if $M(S,a)=1$ and $a_i = b$.  
    \item (\textbf{Anti-commutation test}) Sample $(i_X,i_Z)\in \{1,\ldots,n\}^2 $ uniformly at random. Let $\omega = (E_\code e_{i_X}, E_\code e_{i_Z})$ and $\gamma =  (E_\code e_{i_X}) \cdot(E_\code e_{i_Z}) \in \field$. 
		\begin{enumerate} 
		\item If $\gamma=0$ then sample a pair of questions $(x_c,y_c)$ as in the commutation game. Send $(x_c,\omega)$ to $\alice$ and $(y_c,\omega)$ to Bob. Accept if and only if their answers are accepted in the commutation game. 
		\item If $\gamma\neq 0$ then do the same but for the anti-commutation game. 
		\end{enumerate} 
		 \item (\textbf{Consistency test}) Sample $(i_X,i_Z)\in \{1,\ldots,n\}^2 $ and $W\in \{X,Z\}$ uniformly at random. Let $\omega=(E_\code e_{i_X}, E_\code e_{i_Z})$ and $\gamma = (E_\code e_{i_X}) \cdot(E_\code e_{i_Z}) \in \field$. Send $(W,i_W)$ to $\alice$ and $(x_{W,\gamma},\omega)$ to $\bob$, where $x_{W,\gamma}$ is a question from the anti-commutation game. Receive $a\in \field$ and $b\in \field$ respectively. Accept if and only if $a=b$. 
    \end{enumerate}
  \end{gamespec}
  \caption{The braiding test over $\code$ verifies that the players respond consistently with a uniformly random codeword from $\code$.}
  \label{fig:braiding-test}
\end{figure}

\subsection{A qubit test from any quantum-sound code}

Our main theorem shows that the braiding test is a qubit test, whenever it is instantiated with a pair $(\code,M)$ that is quantum sound. 

\begin{theorem}\label{thm:main}
Let $\code$ be an $[n,k,d]$ linear code and $M$ an $r$-local tester for $\code$ that is $\delta(\eps)$-quantum sound and such that $(\code,M)$ is Abelian. Then the braiding test over $\code$ is a $(k,\delta')$-qubit test with sets $S_X=S_Z=\{E_\code e_i:\,i\in\{1,\ldots,n\}\}\subseteq \field^k$, map $\phi(W,E_\code e_i)=(W,i)$ and error function $\delta' = O(\delta^{1/2}(6\eps))$.\footnote{Assume $E_\code$ has no repeated columns.} 
\end{theorem}

Before we give the proof of the theorem we introduce a game, which we denote $G_{\dlS}$, that is a specific instantiation of a more general class of games analyzed in~\cite[Section 3.4]{de2022spectral}. The proof of soundness of the qubit test will be a reductio to the results from~\cite{de2022spectral}. Using notation from~\cite{de2022spectral}, the game $G_{\dlS}$ is obtained by making the following choices. The group is $H=\field^k$. Let
\[ S_X=S_Z=\{G_\code e_i:\,i\in\{1,\ldots,n\}\}\subseteq \field^k\;,\]
and let $\mu_{\dlS}$ be the uniform distribution over $S_X\times S_Z$. Let $\Omega$ be the support of $\mu_{\dlS}$ and $\alpha,\beta$ the coordinate projections. Then $G_{\dlS}=(\mX,\mu_{\dlS},\mA,D)$ has question set $\mX = \{PX,PZ\} \cup (\mX_{com}\times \Omega_+) \cup (\mX_{anticom} \times \Omega_-)$ and is as described in~\cite[Section 3.4]{de2022spectral}. For clarity we recall the game, using our notation, in Figure~\ref{fig:dlS}. 

\begin{figure}[!htbp]
  \centering
  \begin{gamespec}
Let $S_X,S_Z\subseteq \field^k$.  Sample $\omega = (\omega_X,\omega_Z)\in S_X \times S_Z $ uniformly at random. Let $\gamma = \omega_X \cdot \omega_Z \in \field$. Execute either of the following tests with probability $1/3$ each. 
    \begin{enumerate}
      \setlength\itemsep{1pt}
    \item (\textbf{Anti-commutation test}) 
		\begin{enumerate}
		\item If $\gamma=0$ then sample a pair of questions $(x_c,y_c)$ as in the commutation game. Send $(x_c,\omega)$ to $\alice$ and $(y_c,\omega)$ to Bob. Accept if and only if their answers are accepted in the commutation game. 
		\item If $\gamma\neq 0$ then do the same but for the anti-commutation game. 
		\end{enumerate} 
		 \item (\textbf{$Z$-Consistency test}) Send $Z$ to $\alice$ and $(x_{Z,\gamma},\omega)$ to $\bob$. Receive $a\in \field^k$ and $b\in \field$ respectively. Accept if and only if $a\cdot \omega_Z=b$. 
		 \item (\textbf{$X$-Consistency test}) Send $X$ to $\alice$ and $(x_{X,\gamma},\omega)$ to $\bob$. Receive $a\in \field^k$ and $b\in \field$ respectively. Accept if and only if $a\cdot \omega_X=b$. 
    \end{enumerate}
  \end{gamespec}
  \caption{The game $G_{\dlS}$ checks (anti)commutation relations between two collections of observables.}
  \label{fig:dlS}
\end{figure}

We will also make use of the following simple fact. 


\begin{lemma}[Data-processing]\label{lem:dp}
Let $\{P_a\}$ and $\{Q_a\}$ be two POVMs on $(\mM,\tau)$ with the same outcome set $\mA$. Then for any function $f:\mA\to \mB$ for some finite set $\mB$, 
\begin{equation}\label{eq:dp}
\sum_{b\in \mB} \Big\| \sum_{a\in f^{-1}(b)} (P_a-Q_a) \Big\|_2^2 \,\leq\, \sum_{a\in \mA} \big\| P_a-Q_a\big\|_2^2\;.
\end{equation}
\end{lemma}

\begin{proof}
This follows by expending the left-hand side and using $\tau(P_aQ_{a'})\geq 0$ for all $a\neq a'$. 
\end{proof}


\begin{proof}[Proof of Theorem~\ref{thm:main}]
\underline{Completeness:} We first verify completeness. For $W\in\{X,Z\}$, $i\in\{1,\ldots,n\}$ and $b\in \F_2$ let $P^{(W,i)}_b = \frac{1}{2}(\Id + (-1)^b\sigma^W(E_\code e_i))$, and for $a\in \F_2^S$ let $P^{(W,S)}_a = \prod_{i\in S} P^{(W,i)}_{a_i}$. Writing $(f_0,f_1)$ for the canonical basis of $\C^2$, $P^{(W,S)}_a$ is the projection on the span of all $\otimes_{i=1}^k f_{u_i}$ where $u=(u_1,\ldots,u_k)$ is such that $u^T E_\code=a$.   

For $(i_X,i_Z)\in \{1,\ldots,n\}^2 $ let $\omega=(E_\code e_{i_X}, E_\code e_{i_Z})$ and $\gamma =(E_\code e_{i_X}) \cdot(E_\code e_{i_Z}) $ we let $P^{x_{W,\gamma},\omega} = P^{(W,i_W)}$. 

These choices already ensure that the strategy succeeds with probability $1$ in the consistency test. We verify that it succeeds in the code test. Let $S\subseteq\{1,\ldots,n\}$. As observed above, for any $a\in\field^S$ such that $P^{W,S}_a\neq 0$ there is an $u\in \field^k$ such that $u^TE_\code=a$, which means that $a\in \code$. 
% and $h\in \F_2^S$ any valid parity check, i.e.\ $h^T E_\code=0$, for $\code$ with support in $S$. Then $\sum_{i\in S} h_i E_\code e_i = 0$, so $\prod_{i\in S}(\sigma^W(E_\code e_i))^{h_i}=\Id$. This means that for any $a\in\field^S$ such that $P^{W,S}_a\neq 0$, we have that $h\cdot a =0$, i.e.\ $a$ satisfies the parity check 
\hnote{this probably requires a line or two of justification?}\tnote{rewrote}. Using the completeness property of $M$ it follows that $M$ must accept any $a$ such that $P^{W,S}_a\neq 0$, which shows that the strategy succeeds in the code test with probability $1$. 

It remains to verify that the anti-commutation test is passed with probability $1$. For this we observe that 
% To define $P^{(x_c,\omega)}$ and $P^{(x_a,\omega)}$ for $x_c\notin \{x_{Z,0},x_{Z,0}\}$ and $x_a \notin \{x_{X,1},x_{Z,1}\}$ we observe that 
the binary observables 
\[ U=\widehat{ P}^{x_{X,\gamma},\omega} \quad\text{and}\quad V= \widehat{P}^{x_{Z,\gamma},\omega} \]
commute in case $\gamma=0$ and anti-commute in case $\gamma=1$. This is because by construction $U=\sigma^X(E_\code i_X)$ and $V=\sigma^W(E_\code i_W)$, and because of the definition of $\gamma$. Hence the pair $(U,V)$ can be completed to a perfect strategy for the commutation game (if $\gamma=0)$ or anti-commutation game (if $\gamma=1)$. This \hnote{what does ``this'' refer to?}\tnote{The previous sentence, the ``completion'', how do you want to write it?} defines the measurements $P^{(x,\omega)}$ for $x\notin \{x_{W,\gamma},W\in\{X,Z\},\gamma\in\{0,1\}\}$. 

\bigskip 

\underline{Soundness:} Next we show soundness. Let $\strategy$ be a synchronous strategy for the braiding test  in  $(\mM,\tau)$ that succeeds with probability at least $1-\eps$. For $W\in\{X,Z\}$ let $\strategy^W$ be the strategy in $G_{\code,M}$ \hnote{should be $G$, right?}\tnote{No I think it's correct, there is no $G$ here} that is obtained by restricting $\strategy$ to the relevant measurements, i.e.\ the $P^{W,S}$ and $P^{W,i}$.  Then $\strategy^W$ succeeds with probability at least $1-3\eps$ in $G_{\code,M}$ \hnote{is this because the ``Code test'' is actually just $G_{\code,M}$?}\tnote{yes}. Using the assumption that $M$ is $\delta(\cdot)$-quantum sound and the second item from Proposition~\ref{prop:sound-game} it follows that there is a $\delta_1 = O({\delta(6\eps)})$ such that for each $W\in\{X,Z\}$, $\strategy^W$ is $(\delta_1,\nu)$ close to a perfect strategy $\tilde{\strategy}^W$ on $(\mN^W,\tau^W)$ for $G_{\code,M}$, where $\nu$ is uniform on $\{1,\ldots,n\}$. This strategy has measurement operators $\{ \tilde{P}^{W,S}_a\}$ and $\{\tilde{P}^{W,i}_b\}$ associated with questions of the form $S$ and $i$ in $G_{\code,M}$. Using the definition of $\nu$, these satisfy that 
\begin{equation}\label{eq:main-0}
\Es{i\in\{1,\ldots,n\}}\sum_{b \in \F_2} \big\|P^{W,i}_b - (w^W)^* \tilde{P}_b^{W,i} w^W \big\|^2_2 \,=\, O(\delta_1)\;.
\end{equation}
Furthermore, since $(\code,M)$ is Abelian, there is a  POVM $\{\tilde{P}^W_u\}_{u\in \field^n}$ such that $\sum_{u\in \code}\tilde{P}^W_u = \Id$ and for each $i\in \{1,\ldots,n\}$, $\tilde{P}^{W,i}_b = \sum_{u:u_i=b} \tilde{P}^W_u$.
 
Applying Lemma~\ref{lem:pull-back}, we obtain projective measurements $\{Q^W_u\}$ on $\mM$ such that 
\begin{equation}\label{eq:main-1}
\sum_u \big\|Q^W_u - (w^W)^* \tilde{P}_u^W w^W \big\|^2_2 \,=\, O(\delta_1)\;.
\end{equation}
For any $i\in\{1,\ldots,n\}$ let $Q^{W,i}_b = \sum_{a:\,a_i=b}  Q^W_a$. Then by Lemma~\ref{lem:dp},
\begin{align*}
\Es{i}\sum_b \tau\big( Q^{W,i}_b (w^W)^*\tilde{P}^{W,i}_b(w^W) \big)
&\geq \Es{i}\sum_a \tau\big( Q^{W}_a (w^W)^*\tilde{P}^{W}_a(w^W) \big)\\
&\geq 1-O(\delta_1)\;.
\end{align*}
For $W\in\{X,Z\}$ and $b\in \F_2^k$ let $R^W_b = Q^W_{G_\mC^T b}$, where by definition $G_\mC^T b\in \mC$. 

We now define a strategy $\strategy'$ for the game $G_{\dlS}$. On question $W\in \{X,Z\}$ the projective measurement is $\{R^W_b\}$. On question of the form $(x_c,\omega)$ for $x_c$ a question in the commutation game, the projective measurement is $\{P^{x_c,\omega}\}$, i.e.\ the same projective measurement as used in $\strategy$. Similarly, on a question of the form $(x_{ac},\omega)$ for $x_{ac}$ a question in the anti-commutation game, the projective measurement is $\{P^{x_{ac},\omega}\}$.

To conclude we show that this strategy succeeds in the game $G_{\dlS}$ with probability $1-O(\sqrt{\delta_1})$. Assuming that this has been shown, by~\cite[Corollary 3.9]{de2022spectral} the strategy $\strategy'$ is $O(\sqrt{\delta_1})$-close to a strategy $\strategy''$ on an algebra of the form $(M_{2^{k}}(\C)\otimes \mN,\tr\otimes \tau')$ such that $P^W_b = \sigma^W_b\otimes I_\mN$. By definition of $R$, 
\begin{equation}\label{eq:main-3}
 Q^{W,i}_b \,=\,  \sum_{a \in \F_2^n:\,a_i=b}  Q^W_a \,=\, \sum_{c \in \F^k_2: (G_\mC^T c)_i=b}  R^W_c \;,
\end{equation}
hence
\begin{equation*}
 \widehat{Q}^{W,i}\,=\, \sum_c (-1)^{c\cdot (G_\mC e_i)} R^W_c \,=\, \widehat{R}^W(G_\mC e_i)\;.
\end{equation*}
Using the definition of the game distribution, closeness of $\strategy'$ and $\strategy''$ thus implies that
\begin{equation*}
\Es{i\in\{1,\ldots,n\}} \big\|\widehat{Q^{W,i}} - (w'')^* {\sigma^W}(G_\mC e_i) (w'') \big\|_2^2 \,=\,O(\sqrt{\delta_1})\;.
\end{equation*}
Combining with~\eqref{eq:main-0} and~\eqref{eq:main-1}, this shows the theorem.

It remains to verify that $\strategy'$ succeeds in the game $G_{\dlS}$ with probability $1-O(\sqrt{\delta_1})$. By definition $\strategy'$ succeeds in the (anti)-commutation test with probability $1-O(\eps)$. It remains to check the $W$-consistency test, for $W\in\{X,Z\}$. Because $\strategy$ succeeds with probability $1-O(\eps)$ in the consistency test, 
\begin{equation*}
\Es{i_X,i_Z\in\{1,\ldots,n\}} \sum_b \tau\big( P^{W,i}_b P^{x_{W,\gamma},\omega}_b\big) \,\geq\, 1-O(\eps)\;,\
\end{equation*}
where $\omega$ and $\gamma$ are defined as in Figure~\ref{fig:braiding-test}. Using~\eqref{eq:main-0},~\eqref{eq:main-1}
and Lemma~\ref{lem:close-value} it follows that 
\begin{equation*}
\Es{i_X,i_Z\in\{1,\ldots,n\}} \sum_b \tau\big( Q^{W,i}_b P^{x_{W,\gamma},\omega}_b\big) \,\geq\, 1-O(\sqrt{\delta_1})\;,\
\end{equation*}
Using~\eqref{eq:main-3}, this can be rewritten as 
\begin{equation}\label{eq:main-4}
\Es{i_X,i_Z\in\{1,\ldots,n\}} \sum_{b,c: (G_\mC^T c)_i=b} \tau\big( R^{W}_c P^{x_{W,\gamma},\omega}_b\big) \,\geq\, 1-O(\sqrt{\delta_1})\;.
\end{equation}
Since $\omega_W = G_\mC e_i$, $(G_\mC^T c)_i = c\cdot \omega_W$. Thus~\eqref{eq:main-4} shows that $\strategy'$ succeeds with probability $1-O(\sqrt{\delta_1})$ in the $W$-consistency test, as desired. 
\end{proof}




\section{Application: the Pauli braiding test}
\label{sec:pbt}

In this section we give apply the general construction from Section~\ref{sec:main} to a specific quantum-sound code with particularly good parameters, the Reed-Muller code. This was shown sound in~\cite{ji2022quantum} as part of a slightly more general class of ``tensor codes'' shown quantum sound. The resulting qubit test is an important ingredient in the work~\cite{ji2020mip}.


\subsection{Code composition}
\label{sec:code-comp}

Theorem~\ref{thm:main} requires a quantum-sound code defined over the binary field.  The Reed-Muller code is defined over $\F_q$, for $q$ a large prime power. We can transform any $q$-ary code, for $q=2^t$, into a binary code using the idea of \emph{code composition} which we now describe. 

For $q=2^t$ and $a\in \field$ we let $\kappa(a)\in\F_2^t$ denote the binary representation of $a$, taken in a fixed but usually left implicit self-dual basis of $\F_2^t$ over $\F_2$. We extend $\kappa$ to vectors over $\field$ coordinate-wise. We let $\tr(\cdot):\F_q\to\F_2$ denote the trace over $\F_2$. Because we chose a self-dual basis for the binary representation, the trace satisfies $\tr(ab)=\kappa(a)\cdot\kappa(b)$. 

Let $q=2^t$ and $\code$ an $[n,k,d]_q$ linear code. Let $\code_{\Had}$ be the Hadamard code over $\F_2^t$ (see Section~\ref{sec:had}). Let $T=2^t$.
Let $\mC'$ be the $[Tn,tk,d']$ linear code over $\F_2$ defined as follows. Given $a\in (\F_2^t)^{k}$, first map $a\mapsto a'=\kappa^{-1}(a) \in \F_q^{k}$. Then encode $a'$ to $b'=\code_\RM(a')\in \F_q^n$. Finally, return $b=\code_\Had(\kappa(b'))\in(\F_2^T)^n$, where $\code_\Had$ is applied component-wise. Using that $\code_\Had$ has relative distance $\frac{1}{2}$, it is easy to verify that this code has distance $d'\geq dT/2$.

Given an $r$-local $\delta$-tester $M$ for $\code$, there is a natural $rq$-local tester $M'$ for $\code'$ which can be described as follows. Index coordinates of $\code'$ by pairs $(i,\alpha)\in [n]\times\F_2^t$, fixing a bijection between $[Tn]$ and $[n]\times \F_2^t$. Then $\nu'$ is the uniform mixtures of two distributions, $\nu'_1$ and $\nu'_2$. To sample from $\nu'_1$, sample $S\sim\nu$ and return the set $S\times\F_2^t$. To sample from $\nu'_2$, sample $i\sim[n]$ uniformly at random and $x,y\in\F_2^t$ uniformly at random, and return $\{i\}\times\{x,y,x+y\}$. The decision predicate $M'$ executes $M$ for all sets of the form $S\times \F_2^t$, and the tester for the Hadamard code (Section~\ref{sec:had}) for sets of the form $\{i\}\times\{x,y,x+y\}$.


\begin{proposition}\label{prop:q-to-2}
Suppose that $M$ is an $r$-local tester for $\code$ with quantum soundness $\delta$. Then $M'$ is an $rq$-local tester for $\code'$ with quantum soundness $\delta'$ such that $\delta'(\eps)=\delta(O(\eps))$. 
\end{proposition}

\begin{proof}
Let $\{A^{(i,\alpha)}\}$ and $\{B^{S,(i,\alpha)}\}$ be an $\eps$-local presentation of $\code'$. By definition of the measure $\nu'$, there are $\{\eps_i\}$ such that $\Es{i} \eps_i \leq 2\eps$ and for every $i$, the collections $\{A^{(i,\alpha)}\}$, for $\alpha \in \F_2^t$, and $\{B^{\{i\}\times \{x,y,x+y\},(i,x)}\}$, for $x,y\in\F_2^t$, form an $\eps_i$-local presentation of $\code_\Had$. By quantum soundness of $\code_\Had$ (Theorem~\ref{thm:had-qsound}) $\{i\}\times\{x,y,x+y\}$), for each $i$ there exists commuting $\{\hat{A}^{(i,\alpha)}\}$ that are $O(\eps_i)$-close to the $\{A^{(i,\alpha)}\}$ and moreover are a representation of $\code_{\Had}$. Let $w^{(i)}$ be the implied isometry. For every $a\in \F_2^t$, define $\hat{A}^{i}_{a}=\Es{\alpha}(-1)^{a\cdot \alpha} \hat{A}^{(i,\alpha)}$. Then by linearity this is a projective measurement:
\begin{align*}
\big(\hat{A}^{i}_{a}\big)^2 &=\Big(\Es{\alpha}(-1)^{a\cdot \alpha} \hat{A}^{(i,\alpha)}\Big)^2\\
&= \Es{\alpha,\alpha' }(-1)^{a\cdot (\alpha+\alpha')} \hat{A}^{(i,\alpha)}\hat{A}^{(i,\alpha')}\\
&=\Es{\alpha,\alpha' }(-1)^{a\cdot (\alpha+\alpha')} \hat{A}^{(i,\alpha+\alpha')}\\
&=\hat{A}^{i}_{a}\;,
\end{align*}
where the third line uses that  $\{A^{(i,\alpha)}\}$ are a representation of $\code_{\Had}$. Moreover, $\sum_a \hat{A}^{i}_{a} = \hat{A}^{(i,0)}=\Id$. Hence using Lemma~\ref{lem:pull-back}, for every $i$ we obtain a projective measurement $\{\tilde{A}^{i}_{a}\}$ on $\cM$ such that
\begin{equation}\label{eq:qto2-1a}
 \sum_a \big\| \tilde{A}^i_a - (w^{(i)})^* \hat{A}^i_a (w^{(i)}) \big\|_2^2 \,=\, O(\eps_i)\;.
\end{equation}
%Moreover,
%\begin{equation}\label{eq:qto2-1}
%\Es{i} \Es{\alpha}  \Big\| A^{(i,\alpha)} - \sum_a (-1)^{a\cdot\alpha}(w^{(i)})^* \hat{A}^i_a (w^{(i)})\Big\|^2
%\,=\, \Es{i} \Es{\alpha}  \big\| A^{(i,\alpha)} - (w^{(i)})^* \hat{A}^{i,\alpha} (w^{(i)})\big\|^2 \,=\, O(\eps)\;,
%\end{equation}
%by closeness. Combining~\eqref{eq:qto2-1a} with~\eqref{eq:qto2-1} through the triangle inequality gives
We then get
\begin{align}
 \Es{i} \sum_a \Big\| \Es{\alpha} (-1)^{a\cdot \alpha} A^{(i,\alpha)} -  \tilde{A}^i_a \Big\|_2^2 
&\leq  2\Es{i} \sum_a \Big\| \Es{\alpha} (-1)^{a\cdot \alpha} A^{(i,\alpha)} -  (w^{(i)})^* \hat{A}^i_a (w^{(i)}) \Big\|_2^2 + O(\eps)\notag\\
&=  2\Es{i} \sum_a \Big\| \Es{\alpha} (-1)^{a\cdot \alpha} A^{(i,\alpha)} -   \Es{\alpha} (-1)^{a\cdot \alpha} (w^{(i)})^* \hat{A}^{i,\alpha} (w^{(i)}) \Big\|_2^2+ O(\eps) \notag\\
&= 2\Es{i} \Es{\alpha} \big\| A^{(i,\alpha)} -    (w^{(i)})^* \hat{A}^{i,\alpha} (w^{(i)}) \big\|_2^2+ O(\eps)\notag\\
&= O(\eps)\;, \label{eq:qto2-2}
\end{align}
where the first line uses the triangle inequality and~\eqref{eq:qto2-1a}, the second line uses the definition of $\hat{A}^i_a$, the third line is Parseval's identity and the last is by closeness. 

Now for $b\in \F_q$ define $\tilde{B}^{S,i}_b= \Es{\alpha} (-1)^{b\cdot \alpha} B^{S\times \F_2^t,(i,\alpha)}$, which for the same reasons as earlier is a projective measurement. 
To conclude we show that $\{\tilde{A}^{i}\}$ and $\{\tilde{B}^{S,i}\}$ form an $O(\eps)$-presentation of $\code$. The fact that the $\{\tilde{B}^{S,i}\}$ satisfy the constraints imposed by $M$ is clear, because $\{B^{S,(i,\alpha)}\}$ satisfy those of $M'$. For the closeness condition, we have
\begin{align*}
\Es{S}\Es{i} \sum_b \big\| \tilde{A}^i_b - \tilde{B}^{S,i}_b \big\|_2^2
&\leq 2\Es{S}\Es{i} \sum_b \Big\| \Es{\alpha} (-1)^{b\cdot \alpha} {A}^{(i,\alpha)} - \Es{\alpha} (-1)^{b\cdot \alpha} B^{S\times \F_2^t,(i,\alpha)}\Big\|_2^2 + O(\eps)\\
&= 2\Es{S}\Es{i} \Es{\alpha}\big\|  {A}^{(i,\alpha)} -  B^{S\times \F_2^t,(i,\alpha)}\big\|_2^2 + O(\eps)\\
&\leq 4\eps + O(\eps)\;,
\end{align*}
where the first inequality is by~\eqref{eq:qto2-2} and the triangle inequality, the second line by Parseval's formula and the last is by assumption. Thus quantum soundness of $\code'$ follows from quantum soundness of $\code$. 
\end{proof}






\subsection{The Reed-Muller code over $\F_q$}

Fix integers $m,t \in \N$ and let $q=2^t$ and $M = 2^m$. Let $\mP(q,m,d)$ be the vector space over $\F_q$ that consists of all $m$-variate polynomials $f$ over $\F_q$ of individual degree at most $d$, that is all functions of the form
\[
	f(x_1,\ldots,x_m) = \sum_{\alpha \in \{0,1,\ldots,d\}^m} c_\alpha\,
  x_1^{\alpha_1} \cdots x_m^{\alpha_m}\;,
\]
where $\{c_\alpha\}$ is a collection of coefficients in $\F_q$. It is easy to verify that $\mP(q,m,d)$ has dimension $D = (d+1)^m$ over $\F_q$. It follows that the map $\mC_\RM: (c_\alpha) \mapsto f$ defines a $[q^m,(d+1)^m,D]_q$ linear code over $\F_q$, where $D\geq (1-md/q)q^m$ follows from the Schwartz-Zippel lemma: 

\begin{lemma}[Schwartz-Zippel lemma~\cite{Sch80,Zip79}]
  \label{lem:schwartz-zippel}
  Let $f, g: \F_q^m \to \F_q$ be two unequal polynomials with total degree at most $d$. Then
  \begin{equation*}
    \Pr_{x \sim \F_q^m}\big(f(x) = g(x)\big) \leq \frac{d}{q}\;.
  \end{equation*}
\end{lemma}


We define a tester $M_{\RM}$ for the code $\mC_\RM$ over $\F_q$, see Figure~\ref{fig:RM-tester}. The second test applied by the tester, the subcube commutation test, may seem superfluous, because it always accepts. However, the test is important to show that the code is robust. Note that including the test imposes a non-trivial constraint of pairwise approximate commutation on representations of $\mC_\RM$, and hence also on $\eps$-local presentations. In particular, due to the presence of this test the pair $(\code_\RM,M_\RM)$ is trivially Abelian. 


\begin{figure}[!htbp]
  \centering
  \begin{gamespec}
Perform one of the following tests with probability~$\tfrac{1}{2}$ each. 
\begin{enumerate}
	\item \textbf{Axis-parallel lines test:}
		Let $u \sim \F_q^m$ be a uniformly random point, $j\sim \{1,\ldots,m\}$ chosen uniformly at random,
		and let $\ell = \{ (u_1,\ldots,u_{j-1},s,u_{j+1},\ldots,u_m) \in \F_q^m : s \in \F_q \}$
		be the axis-parallel line passing through $u$ in the $j$-th direction. Read the entries indexed by $\ell$ and accept if and only if they match a degree-$d$ polynomial. 
	\item \textbf{Subcube commutation test:}
	Sample $j \sim \{1,\ldots,m\}$ uniformly at random, and sample $x_{m-j+2},\ldots,x_{m} \sim \F_q$ uniformly at random. Sample $u,v$ independently and uniformly at random from $\F_q^m$, conditioned on the last $(j-1)$ coordinates of both points being $x_{m-j+2},\ldots,x_m$. Read the entries indexed by $u$ and $v$ and accept. 	
    \end{enumerate}
  \end{gamespec}
  \caption{A local test for $\code_{\RM}$}
  \label{fig:RM-tester}
\end{figure}



\begin{theorem}\label{thm:mrm-sound}
$M_\RM$ has quantum soundness $\delta(\eps)=\poly(m,d)\cdot \poly(\eps,n^{-1})$.
\end{theorem}

\begin{proof}
In~\cite{ji2022quantum} it is shown that the game $G_{\code_\RM,M_\RM}$ (played using $\F_q$ as the base field) is $(\delta,\nu)$-robust, where $\nu$ is the uniform distribution over $\F_q^m \subseteq \mX$ and $\delta$ satisfies $\delta(\eps)=\poly(m,d)\cdot \poly(\eps,n^{-1})$. The theorem follows by the second item of Proposition~\ref{prop:sound-game}. 
\end{proof}


\subsection{The Pauli braiding test}

\hnote{is this the ``right'' name? I thought Pauli braiding test was the large question version.}\tnote{Well actually it's ``Pauli basis test'' which is the version from NW. Here, it's closer to the ``quantum low-degree test,'' but it's more general. Technically ``Pauli braiding'' is introduced in the paper by Anand and I on the quantum linearity test, which at least has the merit of falling in the class of tests considered here. So we could say that and explain why we now use the name ``Pauli braiding'' for a more general class. Would that be ok?} 

By applying Proposition~\ref{prop:q-to-2} to the tester $M_\RM$, which is quantum sound by Theorem~\ref{thm:mrm-sound}, we deduce that $M'_\RM$, defined from $M_\RM$ as in Section~\ref{sec:code-comp}, is an $O(\delta)$-sound $rq$-local tester for the binary code $\code'_{\RM}$, where $\delta$ is as in Theorem~\ref{thm:mrm-sound}. This allows us to apply Theorem~\ref{thm:main} to obtain a concrete instantiation of the braiding test.\footnote{\tnote{``History'' of PBT could be described here}} We call it the Pauli braiding test. For completeness, we give a description of the test in its entirety in Figure~\ref{fig:pauli-braiding}. To formulate the test, we make explicit the sets $S_X$ and $S_Y$. For the rows of the generating matrix $E_{\code_\RM}$ we take an arbitrary basis of all individual degree-$d$ polynomials, e.g.\ for $\alpha \in \{0,\ldots,d\}^m$, 
\[ \ind_{\alpha}(x) = \prod_{i} x_i^{\alpha_i} (1-x_i)^{d-\alpha_i}\;.\]
Then the $x$-th column of $E_{\code_\RM}$, $E_{\code_{\RM}}e_x$ for $x\in \F_q^m$, has entries $\ind(x)=(\ind_{\alpha}(x))_{\alpha\in\{0,\ldots,d\}^m}$.

\begin{figure}[!htbp]
  \centering
  \begin{gamespec}
Let $S_X,S_Z\subseteq \field^k$.  Sample $u_X,u_Z \in \F_q^m$ and $r_X,r_Z\in \F_q$ uniformly at random. Let $\omega_X = \ind(u_X)$, $\omega_Z=\ind(u_Z)$, and  $\omega = (\omega_X,\omega_Z,r_X,r_Z)\in (\F_q^{(d+1)^m})^2 \times (\F_q)^2$. Let 
$\gamma = \tr((r_X\omega_X) \cdot (r_Z\omega_Z)) \in \F_2$.
 Execute either of the following tests with probability $1/3$ each. 
\begin{enumerate}
      \setlength\itemsep{1pt}
    \item (\textbf{Code test}) Sample $W\in \{X,Z\}$ uniformly at random, and $(S,T)\subseteq \F_q^{(d+1)^m} \times \F_2^t$ from $\nu'_\RM$. Sample $(i,\alpha)\in (S,T)$ uniformly at random. Send $(W,(S,T))$ to $\alice$ and $(W,(i,\alpha))$ to $\bob$. Receive $a\in \F_2^{S\times T}$ from $\alice$ and $b\in \F_2$ from $\bob$. Accept if and only if $M'_\RM((S,T),a)=1$ and $a_{(i,\alpha)} = b$.  
    \item (\textbf{Anti-commutation test}) 
		\begin{enumerate}
		\item If $\gamma=0$ then sample a pair of questions $(x_c,y_c)$ as in the commutation game. Send $(x_c,\omega)$ to $\alice$ and $(y_c,\omega)$ to Bob. Accept if and only if their answers are accepted in the commutation game. 
		\item If $\gamma\neq 0$ then do the same but for the anti-commutation game. 
		\end{enumerate} 
		 \item (\textbf{Consistency test}) sample $W\in \{X,Z\}$ uniformly at random. Send $(W,(\omega_W,r_W))$ to $\alice$ and $(x_{W,\gamma},\omega)$ to $\bob$. Receive $a\in \F_2$ and $b\in \F_2$ respectively. Accept if and only if $a=b$. 
    \end{enumerate}
  \end{gamespec}
  \caption{The Pauli braiding test.}
  \label{fig:pauli-braiding}
\end{figure}




\begin{theorem}
The braiding test is a $(t(d+1)^m,\delta')$-qubit test, for some $\delta'(\eps)=\poly(m,d)\cdot \poly(\eps,n^{-1})$.
\end{theorem}

\begin{proof}
Follows from Theorem~\ref{thm:main} and Theorem~\ref{thm:mrm-sound}.
\end{proof}

As a corollary we obtain quantum soundness for the variant of the Pauli braiding test which is described in~\cite[Section 7.3]{ji2020mip}. This is because any (synchronous) strategy for the latter can be mapped into a strategy for the former. The only difference is that in the variant from~\cite{ji2020mip}, some of the answers, specifically the ones from the ``Code test'' associated with $\code_\RM$, are specified over $\F_q$. Of course this is equivalent to returning the binary representation of all $\F_q$ elements, which is what is required in the ``Code test'' here, for the cases where the set $T=\F_q$. \tnote{This part is loose; I didn't check things formally and I'm not sure we want to either}

%\input{dim_test.tex}

\bibliography{qld}

\notesendofpaper

\end{document}
